require(["jquery"], function ($) {
    CorraUI = function ($, window) {
        
        var currentViewport, oldViewport;
        var options = {
            desktop: 1024,
            tablet: 1023,
            mobile: 767
        };
    
        isPolywood = function() {
            return (window.location.hostname.indexOf('polywood') > -1);
        }
        isTrexFurniture = function() {
            return (window.location.hostname.indexOf('trexfurniture') > -1);
        }
        isAndroid = function () {
            return navigator.userAgent.match(/Android/i) ? true : false;
        };
        isBlackBerry = function () {
            return navigator.userAgent.match(/BlackBerry/i) ? true : false;
        };
        isiOS = function () {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i) ? true : false;
        };
        isWindows = function () {
            return navigator.userAgent.match(/IEMobile/i) ? true : false;
        };
        isTouch = function () {
            return (isAndroid() || isBlackBerry() || isiOS() || isWindows());
        };
        checkMediaQuery = function (width) {
            if (navigator.appName != 'Microsoft Internet Explorer') {
                mql = window.matchMedia("screen and (max-width: " + width + "px)");
                return mql.matches;
            } else {
                return $(window).width() <= width;
            }
        };
        isTablet = function () {
            return checkMediaQuery(options.tablet);
        };
        isMobile = function () {
            return checkMediaQuery(options.mobile);
        };
        isDesktop = function () {
            return !(isTablet(options.tablet) || isMobile(options.mobile));
        };
        init = function (settings) {
            //Merge custom options
            $.extend(options, settings);
            updateViewport();
            if (isTouch()) {
                $("body").addClass("touch");
            } else {
                $("body").addClass("desktop");
            }
            $("body").addClass(currentViewport + "-width");
            
            $(window).resize(function () {
                oldViewport = currentViewport;
                updateViewport();
                if (oldViewport !== currentViewport) {
                    $("body").removeClass("mob-width tab-width desk-width").addClass(currentViewport + "-width");
                }
            });
        };
        updateViewport = function () {
            if (isMobile()) {
                currentViewport = "mob";
            } else if (isTablet()) {
                currentViewport = "tab";
            } else {
                currentViewport = "desk";
            }
            
        };
        getViewport = function () {
            return currentViewport;
        };
        viewportChanged = function () {
            return oldViewport !== currentViewport;
        };
        getBreakPoints = function () {
            return options;
        };
        getIEVersion = function () {
            var sAgent = window.navigator.userAgent;
            var Idx = sAgent.indexOf("MSIE");
    
            // If IE, return version number.
            if (Idx > 0)
                return parseInt(sAgent.substring(Idx + 5, sAgent.indexOf(".", Idx)));
    
            // If IE 11 then look for Updated user agent string.
            else if (!!navigator.userAgent.match(/Trident\/7\./))
                return 11;
    
            else
                return 0; //It is not IE
        };
        isRetina = function() {
            return ((window.matchMedia && (window.matchMedia('only screen and (min-resolution: 192dpi), only screen and (min-resolution: 2dppx), only screen and (min-resolution: 75.6dpcm)').matches || window.matchMedia('only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2/1), only screen and (min--moz-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2)').matches)) || (window.devicePixelRatio && window.devicePixelRatio > 2));
        };
        setRetina = function() {
            if(CorraUI.isRetina()){
                var srcReplace = /(\.[A-z]{3,4}\/?(\?.*)?)$/;
                var inlineReplace = /url\(('|")?([^\)'"]+)('|")?\)/i;
                var cap = "2";
    
                $('.corra-retina').each(function () {
                    if (this.tagName == 'IMG') {
                        var mySrc = $(this).attr("src").replace("_2x", "");
                        var newSrc = mySrc.replace(srcReplace, '_' + cap + 'x$1');
                        $(this).attr("src", newSrc);
                        if (this.complete) {
                            $(this).attr("src", newSrc);
                        }
                    } else {
                        var mySrc = this.style.backgroundImage.replace(inlineReplace, '$2').replace("_2x", "");
                        var newSrc = mySrc.replace(srcReplace, '_' + cap + 'x$1');
                        this.style.backgroundImage = 'url(' + newSrc + ')';
                    }
                });
            }
        };
        responsiveElements = function() {
            $('[data-responsive]').each(function () {
                var baseConfig = $(this).data("responsive");
                //console.log(getViewport());
                if(typeof baseConfig[getViewport()] != 'undefined'){
                    config = baseConfig[getViewport()];
                    var action = config[0];
                    var destination = config[1];
                    $(this)[action](destination);
                    //console.log("changed:" + $(this).attr("id") + " action:" +action + " destination:" +destination);
                }
            });
        };
        responsiveImage = function () {
            var viewportSrc;
            if (isMobile()) {
                viewportSrc = "src-mob";
            } else if (isTablet()) {
                viewportSrc = "src-tab";
            } else {
                viewportSrc = "src-desk";
            }
            $('.responsive-image').each(function () {
    
                if ($(this).parents(".item").length > 0) {
                    if ($(this).parents(".active").length > 0) {
                        $(this).attr('src', $(this).data(viewportSrc));
                    } else {
                        if($(this).attr("src") !== ""){
                            $(this).attr('src', $(this).data(viewportSrc));
                            
                        }
                            $(this).attr('data-src', $(this).data(viewportSrc));
                        
                    }
                } else {
                    $(this).attr('src', $(this).data(viewportSrc));
                }
    
            });
    
        };
        isScrolledIntoView = function (elem)
        {
            var docViewTop = $(window).scrollTop();
            var docViewBottom = docViewTop + $(window).height();
    
            var elemTop = $(elem).offset().top;
            var elemBottom = elemTop ;
    
            return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
        };
        log = function(data){
          console.log(data);
        };
    
        getHighResolutionImageIdentifier = function(){
           //Device like iPhone 5, 6, 6s
            if(window.devicePixelRatio == 2) {
               return "_2x";
            }
            //Device like iPhone 6S plus, Galaxy S5
            else if(window.devicePixelRatio > 2) {
               return "_3x";
            }
            else {
               //Returning null because normally we won't append X with normal images.
               return "";
            }
       };
        highResolutionImageHelper = function(url, imgSizeParam) {
                if (typeof url != 'undefined') {
                    var arrUrl = url.split(".");
                    var lastPart = arrUrl.pop();
                    var firstpart = arrUrl.join(".") + imgSizeParam;
                    return firstpart + '.' + lastPart;
                }
    
        };
    
        
        return this;
        }(jQuery, window);
    });