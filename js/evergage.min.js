/*
 JavaScript Cookie v2.2.1
 https://github.com/js-cookie/js-cookie

 Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 Released under the MIT license
*/
'use strict';var Evergage=function(r){function v(e){v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"===typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};return v(e)}function Q(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function");}function nb(e,a){for(var b=0;b<a.length;b++){var c=a[b];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(e,
c.key,c)}}function T(e,a,b){a&&nb(e.prototype,a);b&&nb(e,b);return e}function C(e,a,b){a in e?Object.defineProperty(e,a,{value:b,enumerable:!0,configurable:!0,writable:!0}):e[a]=b;return e}function ob(e,a){var b=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);a&&(c=c.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}));b.push.apply(b,c)}return b}function w(e){for(var a=1;a<arguments.length;a++){var b=null!=arguments[a]?arguments[a]:{};
a%2?ob(b,!0).forEach(function(a){C(e,a,b[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(b)):ob(b).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(b,a))})}return e}function lc(e,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(a&&a.prototype,{constructor:{value:e,writable:!0,configurable:!0}});a&&wa(e,a)}function Z(e){Z=Object.setPrototypeOf?
Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return Z(e)}function wa(e,a){wa=Object.setPrototypeOf||function(a,c){a.__proto__=c;return a};return wa(e,a)}function xa(e,a,b){xa="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(a,b,e){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=Z(a),null!==a););if(a)return b=Object.getOwnPropertyDescriptor(a,b),b.get?b.get.call(e):b.value};return xa(e,a,b||e)}function aa(e,a){var b=Array.isArray(e)?e:void 0;if(!b){b=
[];var c=!0,d=!1,f=void 0;try{for(var g=e[Symbol.iterator](),l;!(c=(l=g.next()).done)&&(b.push(l.value),!a||b.length!==a);c=!0);}catch(q){d=!0,f=q}finally{try{if(!c&&null!=g["return"])g["return"]()}finally{if(d)throw f;}}}if(!(e=b))throw new TypeError("Invalid attempt to destructure non-iterable instance");return e}function ka(e){if(Array.isArray(e)){var a=0;for(var b=Array(e.length);a<e.length;a++)b[a]=e[a];a=b}else a=void 0;a||(a=Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)?
Array.from(e):void 0);if(!(e=a))throw new TypeError("Invalid attempt to spread non-iterable instance");return e}function ya(e){var a=document.createElement("a");a.href=e;return a}function za(e){var a,b,c,d=[],f=[b=1732584193,c=4023233417,~b,~c,3285377520],g=[],l=unescape(encodeURI(e))+"\u0080",q=l.length;for(g[e=--q/4+2|15]=8*q;~q;)g[q>>2]|=l.charCodeAt(q)<<8*~q--;for(a=q=0;a<e;a+=16){for(b=f;80>q;b=[b[4]+(d[q]=16>q?~~g[a+q]:2*l|0>l)+1518500249+[c&h|~c&k,l=341275144+(c^h^k),882459459+(c&h|c&k|h&k),
l+1535694389][q++/5>>2]+((l=b[0])<<5|l>>>27),l,c<<30|c>>>2,h,k]){l=d[q-3]^d[q-8]^d[q-14]^d[q-16];c=b[1];var h=b[2];var k=b[3]}for(q=5;q;)f[--q]+=b[q]}for(l="";40>q;)l+=(f[q>>3]>>4*(7-q++)&15).toString(16);return l}function la(e,a,b,c){return e.addEventListener?(e.addEventListener(a,b,c),!0):!1}function L(e,a,b,c){return e.removeEventListener?(e.removeEventListener(a,b,c),!0):!1}function pb(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(a){return null}}function Aa(e){var a=1<arguments.length&&
void 0!==arguments[1]?arguments[1]:y;return a&&9===a.nodeType||a&&1===a.nodeType?mc.test(e)?a.getElementsByClassName(e.slice(1)):nc.test(e)?a.getElementsByTagName(e):a.querySelectorAll(e):[]}function oc(e,a){return a.toUpperCase()}function ba(e){return e.replace(pc,oc)}function u(e,a){for(var b=0,c=e.length;b<c&&!1!==a.call(e[b],b,e[b]);b++);}function qb(e){for(var a=arguments.length,b=Array(1<a?a-1:0),c=1;c<a;c++)b[c-1]=arguments[c];a=arguments;b=a.length;for(c=2>b?0:1;c<b;c++)for(var d in a[c])e[d]=
a[c][d];return e}function Ba(e,a){var b=e&&(e.matches||e.webkitMatchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector);return!!b&&b.call(e,a)}function ca(e,a,b){for(var c=[],d=0,f=e.length;d<f;d++)for(var g=e[d][a];null!=g;){c.push(g);if(!b)break;g=g[a]}return c}function ma(e){return!!e&&e===e.window}function U(e){return"function"===typeof e}function D(e){return"string"===typeof e}function rb(e){return!isNaN(parseFloat(e))&&isFinite(e)}function Ca(e){return D(e)?function(a,
b){return Ba(b,e)}:U(e)?e:e instanceof m?function(a,b){return e.is(b)}:function(a,b){return b===e}}function V(e,a){return a&&e.length?e.filter(a):e}function na(e){return D(e)?e.match(qc)||[]:[]}function F(e){return 1<e.length?Da.call(e,function(a,b,c){return sb.call(c,a)===b}):e}function W(e,a,b){if(e&&1===e.nodeType&&a)return e=X.getComputedStyle(e,null),a?b?e.getPropertyValue(a)||void 0:e[a]:e}function Y(e,a){return parseInt(W(e,a),10)||0}function tb(e){if(1<arguments.length&&void 0!==arguments[1]?
arguments[1]:Ea.test(e))return e;if(!Fa[e]){var a=ba(e),b="".concat(a.charAt(0).toUpperCase()).concat(a.slice(1));a="".concat(a," ").concat(rc.join("".concat(b," "))).concat(b).split(" ");u(a,function(a,b){if(b in sc)return Fa[e]=b,!1})}return Fa[e]}function ub(e,a){return(2<arguments.length&&void 0!==arguments[2]?arguments[2]:Ea.test(e))||tc[e]||!rb(a)?a:"".concat(a,"px")}function uc(e,a){e=e.dataset?e.dataset[a]||e.dataset[ba(a)]:e.getAttribute("data-".concat(a));try{return JSON.parse(e)}catch(b){}return e}
function vb(e,a){return Y(e,"border".concat(a?"Left":"Top","Width"))+Y(e,"padding".concat(a?"Left":"Top"))+Y(e,"padding".concat(a?"Right":"Bottom"))+Y(e,"border".concat(a?"Right":"Bottom","Width"))}function wb(e,a){return!a||!xb.call(a,function(a){return 0>e.indexOf(a)})}function vc(e,a,b,c,d){d.guid=d.guid||k.guid++;var f=e.__cashEvents=e.__cashEvents||{};f[a]=f[a]||[];f[a].push([b,c,d]);e.addEventListener(a,d)}function Ga(e){e=e.split(".");return[e[0],e.slice(1).sort()]}function oa(e,a,b,c,d){var f=
e.__cashEvents=e.__cashEvents||{};if(a)f[a]&&(f[a]=f[a].filter(function(f){var g=aa(f,3);f=g[0];var q=g[1];g=g[2];if(d&&g.guid!==d.guid||!wb(f,b)||c&&c!==q)return!0;e.removeEventListener(a,g)}));else{for(a in f)oa(e,a,b,c,d);delete e.__cashEvents}}function yb(e){return e.multiple?ca(Da.call(e.options,function(a){return a.selected&&!a.disabled&&!a.parentNode.disabled}),"value"):e.value||""}function zb(e){if(!pa){var a=y.createElement("table"),b=y.createElement("tr");pa={"*":Ab,tr:y.createElement("tbody"),
td:b,th:b,thead:a,tbody:a,tfoot:a}}if(!D(e))return[];if(wc.test(e))return[y.createElement(RegExp.$1)];a=xc.test(e)&&RegExp.$1;a=pa[a]||pa["*"];a.innerHTML=e;return k(a.childNodes).detach().get()}function Ha(e){e=k(e);e.filter("script").add(e.find("script")).each(function(a,b){!b.src&&yc.test(b.type)&&b.ownerDocument.documentElement.contains(b)&&eval(b.textContent.replace(zc,""))})}function qa(e,a,b){u(e,function(c,d){u(a,function(a,e){a=c?e.cloneNode(!0):e;b?d.insertBefore(a,b&&d.firstChild):d.appendChild(a);
Ha(a)})})}function Ac(e){e.itemAction&&e.itemAction.includes("View")&&Bb()}function Cb(e){-1!==G&&(Ia(!1,e),clearTimeout(G),G=-1)}function Bb(){if(!p.beaconConfig.doNotTrackPingRequestsForActions){Cb(!0);Ja&&Ja();Ja=n.onEventSend.on(Ac);var e=Date.now();if(-1===A||e-A>=p.beaconConfig.minimumActivityTimeToRegister)A=e;G=setTimeout(function(){Ia(!0)},p.beaconConfig.timeOnPageTimerLengthMillis);t.info("Setting up time on page listeners.");L(window,"unload",Ka);la(window,"unload",Ka);L(window,"blur",
La);la(window,"blur",La);L(window,"focus",Ma);la(window,"focus",Ma);L(document,"mousemove keydown scroll click",da);la(document,"mousemove keydown scroll click",da)}}function Ia(e,a){var b=Date.now();-1!==A&&(b-=A,p.beaconConfig.timeOnPageTimerLengthMillis<b?ra():(t.trace("Evergage: timeOnPage before: sendActivityPingRequest: ".concat(x)),x+=b,t.trace("Evergage: timeOnPage after: sendActivityPingRequest: ".concat(x)),-1!==H&&clearTimeout(H),H=setTimeout(ra,p.beaconConfig.timeOnPageTimerLengthMillis-
b)));0<x&&(x=Math.min(x,p.beaconConfig.timeOnPageTimerLengthMillis),(!0!==a||2E3<=x)&&Bc(Cc(x)),x=0);0>x&&(x=0);e&&(-1!==G&&clearTimeout(G),G=setTimeout(function(){Ia(!0)},p.beaconConfig.timeOnPageTimerLengthMillis))}function Cc(e){var a={},b=Db();b&&b.itemAction&&b.catalog&&(a.catalog={},Object.keys(b.catalog).forEach(function(c){var d=b.catalog[c],e=a.catalog;if(p.beaconConfig.trackContextualRelatedItems){if(d=Na(d,["_id","type","dimensions","categories"]),Array.isArray(d.categories)){for(var g=
[],l=0;l<d.categories.length;l++)g.push(Na(d.categories[l],["_id","type"]),l);d=w({},d,{categories:g})}}else d=Na(d,["_id","type"]);e[c]=d;null!=b.action&&(a.action=b.action)}));a.timeOnPageMillis=e;return a}function Ka(e){Cb()}function La(e){try{t.trace("Evergage: window blurred"),ra()}catch(a){ea(a,"windowBlurFunction")}}function Ma(e){try{t.trace("Evergage: window focused"),da()}catch(a){ea(a,"windowFocusFunction")}}function ra(){try{-1!==H&&(clearTimeout(H),H=-1);var e=Date.now(),a=0;-1!==A&&
(a=e-A);t.trace("Evergage: timeOnPage before: setUserInactive: ".concat(x));x+=a;t.trace("Evergage: timeOnPage after: setUserInactive: ".concat(x));A=-1}catch(b){ea(b,"setUserInactive")}}function da(){t.trace("activity registered");try{-1!==H&&(clearTimeout(H),H=-1);var e=Date.now();if(-1===A||e-A>=p.beaconConfig.minimumActivityTimeToRegister)-1!==A&&(t.trace("Evergage: timeOnPage before: activityRegistered: ".concat(x)),x+=e-Math.max(A,-1),t.trace("Evergage: timeOnPage after: activityRegistered: ".concat(x))),
A=e}catch(a){ea(a,"activityRegistered")}}function Dc(){Oa&&Oa();Pa&&Pa();Qa&&Qa();Ra&&Ra();Sa&&Sa();Oa=n.onFireException.on(function(e,a){document.dispatchEvent(new CustomEvent(M.OnException,{detail:{error:e,context:a}}));Eb.send(Ec(e,a))});Pa=n.onEventResponse.on(function(e,a){var b=e.campaignResponses.map(function(a){return a.experienceId});h.campaignResponses=[].concat(ka(e.campaignResponses),ka(h.campaignResponses.filter(function(a){return!b.includes(a.experienceId)})));document.dispatchEvent(new CustomEvent(M.OnEventResponse,
{detail:{response:e,actionEvent:a}}))});Qa=n.onEventSend.on(function(e){document.dispatchEvent(new CustomEvent(M.OnEventSend,{detail:{actionEvent:e}}))});n.onStatSend.on(function(e,a){document.dispatchEvent(new CustomEvent(M.OnStatSend,{detail:{campaignStat:e,campaignResponse:a}}))});Ra=n.onPageMatchStatusUpdated.on(function(e){document.dispatchEvent(new CustomEvent(M.OnPageMatchStatusUpdated,{detail:{matchStatus:e}}))});Sa=n.onInitSitemap.on(function(e){document.dispatchEvent(new CustomEvent(M.OnInitSitemap,
{detail:{sitemapConfig:e}}))})}function R(e){t.info("Shutting down beacon: ".concat(e));sa("shutDown");return!1}var Ta=["error","warn","info","debug","trace"],t=new (function(){function e(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Q(this,e);this.console=window.console;this.level=b;this.prefix=a;this.buildLogFunctions()}T(e,[{key:"shouldLog",value:function(a){return a<=this.level}},{key:"setLoggingLevel",value:function(a){this.level=
"string"===typeof a?Ta.indexOf(a.toLowerCase())+1:a||0;this.buildLogFunctions()}},{key:"getLoggingLevel",value:function(){return this.level}},{key:"setPrefix",value:function(a){this.prefix=a;this.buildLogFunctions()}},{key:"getPrefix",value:function(){return this.prefix}},{key:"buildLogFunctions",value:function(){var a=this;Ta.forEach(function(b,c){b=Ta[c];a[b]=a.shouldLog(c+1)?a.getLogFn(b):function(){}})}},{key:"getLogFn",value:function(a){return Function.prototype.bind.call(this.console.log,this.console,
"[".concat(a.toUpperCase(),"]").concat(this.prefix?"("+this.prefix+")":"",":"))}}]);return e}()),Fc="cdn.".concat("evergage.com"),Ua;(function(e){e.Impression="i";e.Clickthrough="c";e.Dismissal="d";e.Unsubscribe="u";e.Send="s"})(Ua||(Ua={}));(function(e){e.Product="Product";e.Category="Category"})(r.ItemType||(r.ItemType={}));var Va;(function(e){e._id="_id";e.categories="categories";e.dimensions="dimensions"})(Va||(Va={}));var N=function(){function e(){Q(this,e);this.listeners=[]}T(e,[{key:"on",value:function(a){var b=
this;(this.listeners=this.listeners||[]).push(a);return function(){b.listeners=b.listeners.filter(function(b){return b!==a})}}},{key:"once",value:function(a){var b=this;return this.on(function(){b.unbindAll();try{for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];a.apply(b,d)}catch(g){t.error("Signal listener callback error: "+g)}})}},{key:"emit",value:function(){for(var a=this,b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];0!==this.listeners.length&&this.listeners.forEach(function(b){try{b.apply(a,
c)}catch(g){t.error("Signal listener callback error: "+g)}})}},{key:"unbindAll",value:function(){this.listeners=[]}}]);return e}(),Gc=function(e){t.debug("Unbinding all signals for type: ",e);Object.keys(e).forEach(function(a){e[a].unbindAll&&e[a].unbindAll()})},p={endpointConfig:{},beaconConfig:{sendEvents:!0,minimumActivityTimeToRegister:300,timeOnPageTimerLengthMillis:6E4,trackAnonymousVisitors:!0,corsAllowedOrigins:["*"],rememberMeUserIdsMillis:63072E6,actionRateLimiterConfig:{globalLimit:10,
globalTimeRange:5E3,perActionLimit:5,perActionTimeRange:2E3}},visitor:{},beaconState:null},Hc=new N,sa=function(e){p.beaconState=e;Hc.emit(e)},O=function(){return p.visitor||{}},Ic=[/bot/i,/spider/i,/facebookexternalhit/i,/simplepie/i,/yahooseeker/i,/embedly/i,/quora link preview/i,/outbrain/i,/vkshare/i,/monit/i,/Pingability/i,/Monitoring/i,/WinHttpRequest/i,/Apache-HttpClient/i,/getprismatic.com/i,/python-requests/i,/Twurly/i,/yandex/i,/browserproxy/i,/crawler/i,/Qwantify/i,/Yahoo! Slurp/i,/pinterest/i,
/Tumblr\/14.0.835.186/i,/Tumblr Agent 14.0/i],Jc=function(e){return Ic.some(function(a){return a.test(e)})},Kc=navigator.vendor&&-1<navigator.vendor.indexOf("Apple")&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS"),ta=function(e,a){return a={exports:{}},e(a,a.exports),a.exports}(function(e,a){e.exports=function(){function a(){for(var a=0,b={};a<arguments.length;a++){var c=arguments[a],e;for(e in c)b[e]=c[e]}return b}function c(b){function d(){}
function e(c,e,f){if("undefined"!==typeof document){f=a({path:"/"},d.defaults,f);"number"===typeof f.expires&&(f.expires=new Date(1*new Date+864E5*f.expires));f.expires=f.expires?f.expires.toUTCString():"";try{var g=JSON.stringify(e);/^[\{\[]/.test(g)&&(e=g)}catch(Td){}e=b.write?b.write(e,c):encodeURIComponent(String(e)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent);c=encodeURIComponent(String(c)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,
escape);g="";for(var l in f)f[l]&&(g+="; "+l,!0!==f[l]&&(g+="="+f[l].split(";")[0]));return document.cookie=c+"="+e+g}}function l(a,c){if("undefined"!==typeof document){for(var d={},e=document.cookie?document.cookie.split("; "):[],f=0;f<e.length;f++){var g=e[f].split("="),l=g.slice(1).join("=");c||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var q=g[0].replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);l=(b.read||b)(l,q)||l.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent);if(c)try{l=JSON.parse(l)}catch(Mc){}d[q]=
l;if(a===q)break}catch(Mc){}}return a?d[a]:d}}d.set=e;d.get=function(a){return l(a,!1)};d.getJSON=function(a){return l(a,!0)};d.remove=function(b,c){e(b,"",a(c,{expires:-1}))};d.defaults={};d.withConverter=c;return d}return c(function(){})}()}),Fb,Wa=function(e){return"".concat("_evg").concat(e,"_").concat(Fb)},I={setCookieHash:function(e,a,b){Fb=za("".concat(e,".").concat(a,".").concat(za(b+"/").slice(0,4))).slice(0,4)},read:function(e){return ta.getJSON(Wa(e))},write:function(e,a,b,c){ta.set(Wa(e),
a,{expires:b,domain:c})},remove:function(e,a){ta.remove(Wa(e),a)}},Xa,Ya={read:function(e){if(e=sessionStorage.getItem(Xa+e))return e},write:function(e,a){sessionStorage.setItem(Xa+e,a)},setStorageKeyPrefix:function(e,a){Xa="_evg|"+e+"|"+a+"|"}},Gb=function(e){I.write("a",{uuid:e.uuid,puid:e.persistedUserId,paid:e.persistedAccountId,affinityId:e.affinityId},730,p.beaconConfig.cookieDomain);var a=I.read("a");a&&t.debug("Stored visitor cookie. ".concat(JSON.stringify(a)));return e},Hb=function(e){return 0===
e.indexOf("www")?e.substring(4,e.length):e},n=function a(){Q(this,a)};n.onEventSend=new N;n.onStatSend=new N;n.onEventResponse=new N;n.onFireException=new N;n.onPageMatchStatusUpdated=new N;n.onInitSitemap=new N;n.onDeprecatedEventResponse=new N;n.unbindAll=function(){Gc(n)};var ea=function(a,b,c){n.onFireException.emit(a,b);t.warn("sendException",{event,errorSection:b})},M={OnEventResponse:"evergage:onEventResponse",OnEventSend:"evergage:onEventSend",OnStatSend:"evergage:onStatSend",OnException:"evergage:onException",
OnTemplateDisplayEnd:"evergage:onTemplateDisplayEnd",OnPageMatchStatusUpdated:"evergage:onPageMatchStatusUpdated",OnInit:"evergage:onInit",OnInitSitemap:"evergage:onInitSitemap"},E;(function(a){a.Pending="pending";a.Running="running";a.Selected="selected";a.Matched="matched";a.Rejected="rejected"})(E||(E={}));var h={result:{backgroundPage:null,currentPage:null,matchedConfig:null,matchStatus:null},config:{pageTypes:[],currentKey:null,settings:{canonicalizeIds:!1,runOnTranslatedPage:!1,setDefaultListPrice:!1,
truncateTranslated:!0}},campaignResponses:[]};"use strict";var Nc=Object.prototype.hasOwnProperty,Ib=!1,S=[],Jb=function(){Ib=!0;return!1},Oc=function(a){if(Ib)return t.info("Event Rate Limiter previously triggered. Event sending disabled."),!1;var b=Date.now(),c=0,d=0,f=Math.max(p.beaconConfig.actionRateLimiterConfig.globalTimeRange,p.beaconConfig.actionRateLimiterConfig.perActionTimeRange);S.push({name:a,time:b});for(var g=S.length-1;0<=g;g--){if(!(b-S[g].time<f)){S.splice(0,g+1);break}if(b-S[g].time<
p.beaconConfig.actionRateLimiterConfig.globalTimeRange&&(c++,c>p.beaconConfig.actionRateLimiterConfig.globalLimit)||b-S[g].time<p.beaconConfig.actionRateLimiterConfig.perActionTimeRange&&S[g].name===a&&(d++,d>p.beaconConfig.actionRateLimiterConfig.perActionLimit))return Jb()}return!0},y=document,X=window,Ab=y.createElement("div"),P=Array.prototype,Da=P.filter,sb=P.indexOf,Pc=P.map,ua=P.push,Za=P.reverse,Kb=P.slice,xb=P.some,Qc=P.splice,Rc=/^#[\w-]*$/,mc=/^\.[\w-]*$/,Sc=/<.+>/,nc=/^\w+$/,m=function(){function a(b){var c=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:y;Q(this,a);if(b){if(b instanceof m)return b;var d=b;if(D(b)){if(d=c instanceof m?c[0]:c,d=Rc.test(b)?d.getElementById(b.slice(1)):Sc.test(b)?zb(b):Aa(b,d),!d)return}else if(U(b))return this.ready(b);if(d.nodeType||d===X)d=[d];this.length=d.length;c=0;for(var f=this.length;c<f;c++)this[c]=d[c]}}T(a,[{key:"init",value:function(b,c){return new a(b,c)}}]);return a}(),k=m.prototype.init;k.fn=k.prototype=m.prototype;m.prototype.length=0;m.prototype.splice=
Qc;"function"===typeof Symbol&&(m.prototype[Symbol.iterator]=Array.prototype[Symbol.iterator]);m.prototype.get=function(a){return void 0===a?Kb.call(this):this[0>a?a+this.length:a]};m.prototype.eq=function(a){return k(this.get(a))};m.prototype.first=function(){return this.eq(0)};m.prototype.last=function(){return this.eq(-1)};m.prototype.map=function(a){return k(Pc.call(this,function(b,c){return a.call(b,c,b)}))};m.prototype.slice=function(){return k(Kb.apply(this,arguments))};var pc=/-([a-z])/g;
k.camelCase=ba;k.each=u;m.prototype.each=function(a){u(this,a);return this};m.prototype.removeProp=function(a){return this.each(function(b,c){delete c[a]})};m.prototype.extend=function(a){return qb(k.fn,a)};k.extend=qb;k.guid=1;k.matches=Ba;var $a=Array.isArray;k.isWindow=ma;k.isFunction=U;k.isString=D;k.isNumeric=rb;k.isArray=$a;m.prototype.prop=function(a,b){if(a){if(D(a))return 2>arguments.length?this[0]&&this[0][a]:this.each(function(c,f){f[a]=b});for(var c in a)this.prop(c,a[c]);return this}};
m.prototype.filter=function(a){if(!a)return k();var b=Ca(a);return k(Da.call(this,function(a,d){return b.call(a,d,a)}))};var qc=/\S+/g;m.prototype.hasClass=function(a){return a&&xb.call(this,function(b){return b.classList.contains(a)})};m.prototype.removeAttr=function(a){var b=na(a);return b.length?this.each(function(a,d){u(b,function(a,b){d.removeAttribute(b)})}):this};m.prototype.attr=function(a,b){if(a){if(D(a)){if(2>arguments.length){if(!this[0])return;var c=this[0].getAttribute(a);return null===
c?void 0:c}return void 0===b?this:null===b?this.removeAttr(a):this.each(function(c,f){f.setAttribute(a,b)})}for(c in a)this.attr(c,a[c]);return this}};m.prototype.toggleClass=function(a,b){var c=na(a),d=void 0!==b;return c.length?this.each(function(a,g){u(c,function(a,c){d?b?g.classList.add(c):g.classList.remove(c):g.classList.toggle(c)})}):this};m.prototype.addClass=function(a){return this.toggleClass(a,!0)};m.prototype.removeClass=function(a){return arguments.length?this.toggleClass(a,!1):this.attr("class",
"")};k.unique=F;m.prototype.add=function(a,b){return k(F(this.get().concat(k(a,b).get())))};var Ea=/^--/,Fa={},sc=Ab.style,rc=["webkit","moz","ms","o"];k.prefixedProp=tb;var tc={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};m.prototype.css=function(a,b){if(D(a)){var c=Ea.test(a);a=tb(a,c);if(2>arguments.length)return this[0]&&W(this[0],a,c);if(!a)return this;b=ub(a,b,c);return this.each(function(d,
g){g&&1===g.nodeType&&(c?g.style.setProperty(a,b):g.style[a]=b)})}for(var d in a)this.css(d,a[d]);return this};var Tc=/^data-(.+)/;m.prototype.data=function(a,b){var c=this;if(!a){if(!this[0])return;var d={};u(this[0].attributes,function(a,b){(a=b.name.match(Tc))&&(d[a[1]]=c.data(a[1]))});return d}if(D(a))return void 0===b?this[0]&&uc(this[0],a):this.each(function(c,d){c=b;try{c=JSON.stringify(c)}catch(q){}d.dataset?d.dataset[ba(a)]=c:d.setAttribute("data-".concat(a),c)});for(var f in a)this.data(f,
a[f]);return this};u(["Width","Height"],function(a,b){m.prototype["inner".concat(b)]=function(){if(this[0])return ma(this[0])?X["inner".concat(b)]:this[0]["client".concat(b)]}});u(["width","height"],function(a,b){m.prototype[b]=function(c){if(!this[0])return void 0===c?void 0:this;if(!arguments.length)return ma(this[0])?this[0][ba("outer-".concat(b))]:this[0].getBoundingClientRect()[b]-vb(this[0],!a);var d=parseInt(c,10);return this.each(function(c,g){g&&1===g.nodeType&&(c=W(g,"boxSizing"),g.style[b]=
ub(b,d+("border-box"===c?vb(g,!a):0)))})}});u(["Width","Height"],function(a,b){m.prototype["outer".concat(b)]=function(c){if(this[0])return ma(this[0])?X["outer".concat(b)]:this[0]["offset".concat(b)]+(c?Y(this[0],"margin".concat(a?"Top":"Left"))+Y(this[0],"margin".concat(a?"Bottom":"Right")):0)}});var ab={};m.prototype.toggle=function(a){return this.each(function(b,c){if(void 0!==a?a:"none"===W(c,"display")){if(c.style.display="","none"===W(c,"display")){b=c.style;c=c.tagName;if(ab[c])c=ab[c];else{var d=
y.createElement(c);y.body.appendChild(d);var f=W(d,"display");y.body.removeChild(d);c=ab[c]="none"!==f?f:"block"}b.display=c}}else c.style.display="none"})};m.prototype.hide=function(){return this.toggle(!1)};m.prototype.show=function(){return this.toggle(!0)};var bb={focus:"focusin",blur:"focusout"},Lb={mouseenter:"mouseover",mouseleave:"mouseout"},Uc=/^(?:mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;m.prototype.off=function(a,b,c){var d=this;void 0===a?this.each(function(a,b){return oa(b)}):
(U(b)&&(c=b,b=""),u(na(a),function(a,g){a=Ga(Lb[g]||bb[g]||g);a=aa(a,2);var f=a[0],q=a[1];d.each(function(a,d){return oa(d,f,q,b,c)})}));return this};m.prototype.on=function(a,b,c,d){var f=this;if(!D(a)){for(var g in a)this.on(g,b,a[g]);return this}U(b)&&(c=b,b="");u(na(a),function(a,g){a=Ga(Lb[g]||bb[g]||g);a=aa(a,2);var l=a[0],q=a[1];f.each(function(a,f){a=function Lc(a){if(!a.namespace||wb(q,a.namespace.split("."))){var g=f;if(b){for(var h=a.target;!Ba(h,b);){if(h===f)return;h=h.parentNode;if(!h)return}g=
h;a.__delegate=!0}a.__delegate&&Object.defineProperty(a,"currentTarget",{configurable:!0,get:function(){return g}});h=c.call(g,a,a.data);d&&oa(f,l,q,b,Lc);!1===h&&(a.preventDefault(),a.stopPropagation())}};a.guid=c.guid=c.guid||k.guid++;vc(f,l,q,b,a)})});return this};m.prototype.one=function(a,b,c){return this.on(a,b,c,!0)};m.prototype.ready=function(a){var b=function(){return a(k)};"loading"!==y.readyState?setTimeout(b):y.addEventListener("DOMContentLoaded",b);return this};m.prototype.trigger=function(a,
b){if(D(a)){a=Ga(a);var c=aa(a,2);a=c[0];c=c[1];var d=Uc.test(a)?"MouseEvents":"HTMLEvents";var f=y.createEvent(d);f.initEvent(a,!0,!0);f.namespace=c.join(".")}else f=a;f.data=b;var g=f.type in bb;return this.each(function(a,b){if(g&&U(b[f.type]))b[f.type]();else b.dispatchEvent(f)})};var Vc=/%20/g,Wc=/file|reset|submit|button|image/i,Xc=/radio|checkbox/i;m.prototype.serialize=function(){var a="";this.each(function(b,c){u(c.elements||[c],function(b,c){c.disabled||!c.name||"FIELDSET"===c.tagName||
Wc.test(c.type)||Xc.test(c.type)&&!c.checked||(b=yb(c),void 0!==b&&(b=$a(b)?b:[b],u(b,function(b,d){b=a;d="&".concat(encodeURIComponent(c.name),"=").concat(encodeURIComponent(d).replace(Vc,"+"));a=b+d})))})});return a.substr(1)};m.prototype.val=function(a){return void 0===a?this[0]&&yb(this[0]):this.each(function(b,c){if("SELECT"===c.tagName){var d=$a(a)?a:null===a?[]:[a];u(c.options,function(a,b){b.selected=0<=d.indexOf(b.value)})}else c.value=null===a?"":a})};m.prototype.clone=function(){return this.map(function(a,
b){return b.cloneNode(!0)})};m.prototype.detach=function(){return this.each(function(a,b){b.parentNode&&b.parentNode.removeChild(b)})};var xc=/^\s*<(\w+)[^>]*>/,wc=/^\s*<(\w+)\s*\/?>(?:<\/\1>)?\s*$/,pa;k.parseHTML=zb;m.prototype.empty=function(){return this.each(function(a,b){for(;b.firstChild;)b.removeChild(b.firstChild)})};m.prototype.html=function(a){return void 0===a?this[0]&&this[0].innerHTML:this.each(function(b,c){c.innerHTML=a})};m.prototype.remove=function(){return this.detach().off()};m.prototype.text=
function(a){return void 0===a?this[0]?this[0].textContent:"":this.each(function(b,c){c.textContent=a})};m.prototype.unwrap=function(){this.parent().each(function(a,b){a=k(b);a.replaceWith(a.children())});return this};var Mb=y.documentElement;m.prototype.offset=function(){var a=this[0];if(a)return a=a.getBoundingClientRect(),{top:a.top+X.pageYOffset-Mb.clientTop,left:a.left+X.pageXOffset-Mb.clientLeft}};m.prototype.offsetParent=function(){return k(this[0]&&this[0].offsetParent)};m.prototype.position=
function(){var a=this[0];if(a)return{left:a.offsetLeft,top:a.offsetTop}};m.prototype.children=function(a){var b=[];this.each(function(a,d){ua.apply(b,d.children)});return V(k(F(b)),a)};m.prototype.contents=function(){var a=[];this.each(function(b,c){ua.apply(a,"IFRAME"===c.tagName?[c.contentDocument]:c.childNodes)});return k(F(a))};m.prototype.find=function(a){for(var b=[],c=0,d=this.length;c<d;c++){var f=Aa(a,this[c]);f.length&&ua.apply(b,f)}return k(F(b))};var yc=/^$|^module$|\/(?:java|ecma)script/i,
zc=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;m.prototype.append=function(){var a=this;u(arguments,function(b,c){qa(a,k(c))});return this};m.prototype.appendTo=function(a){qa(k(a),this);return this};m.prototype.insertAfter=function(a){var b=this;k(a).each(function(a,d){var c=d.parentNode;c&&b.each(function(b,f){b=a?f.cloneNode(!0):f;c.insertBefore(b,d.nextSibling);Ha(b)})});return this};m.prototype.after=function(){var a=this;u(Za.apply(arguments),function(b,c){Za.apply(k(c).slice()).insertAfter(a)});
return this};m.prototype.insertBefore=function(a){var b=this;k(a).each(function(a,d){var c=d.parentNode;c&&b.each(function(b,f){b=a?f.cloneNode(!0):f;c.insertBefore(b,d);Ha(b)})});return this};m.prototype.before=function(){var a=this;u(arguments,function(b,c){k(c).insertBefore(a)});return this};m.prototype.prepend=function(){var a=this;u(arguments,function(b,c){qa(a,k(c),!0)});return this};m.prototype.prependTo=function(a){qa(k(a),Za.apply(this.slice()),!0);return this};m.prototype.replaceWith=function(a){return this.before(a).remove()};
m.prototype.replaceAll=function(a){k(a).replaceWith(this);return this};m.prototype.wrapAll=function(a){if(this[0]){a=k(a);this.first().before(a);for(a=a[0];a.children.length;)a=a.firstElementChild;this.appendTo(a)}return this};m.prototype.wrap=function(a){return this.each(function(b,c){var d=k(a)[0];k(c).wrapAll(b?d.cloneNode(!0):d)})};m.prototype.wrapInner=function(a){return this.each(function(b,c){b=k(c);c=b.contents();c.length?c.wrapAll(a):b.append(a)})};m.prototype.has=function(a){var b=D(a)?
function(b,d){return!!Aa(a,d).length}:function(b,d){return d.contains(a)};return this.filter(b)};m.prototype.is=function(a){if(!a||!this[0])return!1;var b=Ca(a),c=!1;this.each(function(a,f){c=b.call(f,a,f);return!c});return c};m.prototype.next=function(a,b){return V(k(F(ca(this,"nextElementSibling",b))),a)};m.prototype.nextAll=function(a){return this.next(a,!0)};m.prototype.not=function(a){if(!a||!this[0])return this;var b=Ca(a);return this.filter(function(a,d){return!b.call(d,a,d)})};m.prototype.parent=
function(a){return V(k(F(ca(this,"parentNode"))),a)};m.prototype.index=function(a){var b=a?k(a)[0]:this[0];a=a?this:k(b).parent().children();return sb.call(a,b)};m.prototype.closest=function(a){if(!a||!this[0])return k();var b=this.filter(a);return b.length?b:this.parent().closest(a)};m.prototype.parents=function(a){return V(k(F(ca(this,"parentElement",!0))),a)};m.prototype.prev=function(a,b){return V(k(F(ca(this,"previousElementSibling",b))),a)};m.prototype.prevAll=function(a){return this.prev(a,
!0)};m.prototype.siblings=function(a){var b=[];this.each(function(a,d){ua.apply(b,k(d).parent().children(function(a,b){return b!==d}))});return V(k(F(b)),a)};var z={},Nb=function(a){a=a?(a=ya(a))?a.pathname:"":"";return a},Ob=function(a,b){b="undefined"===typeof b?location.search:b;for(var c=/([^=?&]+)=?([^&]*)/g,d={},f;f=c.exec(b);){var g=pb(f[1]);f=pb(f[2]);null===g||null===f||g in d||(d[g]=f)}return d[a]||""},Pb=function(a,b){return(a=a.exec(b))&&2===a.length?a[1]:null},Qb=function(a){return Pb(/[/]?([^/]*)[/]?$/,
Nb(a))},cb=function(a){return"string"!==typeof a||""===a.trim()?null:ya(a).href},db=function(a){return a&&"string"===typeof a?(a=parseFloat(a.replace(/[^0-9.]+/g,"")),isNaN(a)?null:a):null},Rb=function(a){return a&&"string"===typeof a?(a=parseInt(a.trim().replace(/[^0-9.]+/g,""),10),isNaN(a)?null:a):null},eb=function(a,b){b=b||window;a=a.split(".");var c=!0,d=!1,f=void 0;try{for(var g=a[Symbol.iterator](),l;!(c=(l=g.next()).done);c=!0){var q=l.value;var h=/(\w+)\[([0-9]+)\]/.exec(q);if(b[q])b=b[q];
else if(h){if(b[h[1]]&&(b=b[h[1]][parseInt(h[2],10)],!b))return null}else return null}}catch(K){d=!0,f=K}finally{try{c||null==g.return||g.return()}finally{if(d)throw f;}}return b},Sb={extractFirstGroup:Pb,getLastPathComponent:Qb,getLastPathComponentWithoutExtension:function(a){a=Qb(cb(a));var b=a.lastIndexOf(".");return 0<=b?a.substring(0,b):a},getParameterByName:Ob,getPathname:Nb,qualifyUrl:cb,removeQueryString:function(a){if(!a)return"";a=ya(a);return[a.protocol,"//","http:"===a.protocol&&"80"===
a.port||"https:"===a.protocol&&"443"===a.port?a.hostname:a.host,a?a.pathname:""].join("")},getFloatValue:db,getIntegerValue:Rb,getUtagFirstForField:function(a){var b=window.utag_data;if(b&&b[a]&&0<=b[a].length)return Array.isArray(b[a])?b[a][0]:b[a]},getValueFromNestedObject:eb,buildLineItemFromPageState:function(a){if(h.result.currentPage&&h.result.currentPage.catalog){var b=h.result.currentPage.catalog[r.ItemType.Product];return b?{_id:b._id,price:b.price,quantity:db(k(a).val())}:null}},resolveWhenTrue:{bind:function(a){var b=
1<arguments.length&&void 0!==arguments[1]?arguments[1]:Math.random().toString(36).slice(2),c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:2E3,d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:100;if("function"===typeof a)return new Promise(function(f,g){var l=0,q=setInterval(function(){try{l+=d;var h=a();h&&(delete z[b],clearInterval(q),f(h));l>=c&&(z[b](),delete z[b])}catch(K){delete z[b],clearInterval(q),g(K)}},d);z[b]=function(){clearInterval(q)}})},unbind:function(a){if(!a||"string"!==
typeof a||"function"!==typeof z[a])return null;z[a]();delete z[a]},getBindings:function(){return z},clearBindings:function(){for(var a in z)z.hasOwnProperty(a)&&"function"===typeof z[a]&&(z[a](),delete z[a])}},cookie:ta},fb=function(){function a(b){Q(this,a);this.baseURL=b}T(a,[{key:"send",value:function(a){Yc(a);var b=this.baseURL+"?";var d="";var f=[],g;"string"!==typeof d&&(d="?");for(l in a)if(Nc.call(a,l)){(g=a[l])||null!==g&&void 0!==g&&!isNaN(g)||(g="");var l=encodeURIComponent(l);g=encodeURIComponent(g);
null!==l&&null!==g&&f.push(l+"="+g)}a=f.length?d+f.join("&"):"";b+=a;if(navigator&&navigator.sendBeacon)return a=new Blob([],{type:"application/x-www-form-urlencoded"}),navigator.sendBeacon(b,a);a=new XMLHttpRequest;a.open("GET",b,!0);a.send()}}]);return a}(),Zc=function(a){function b(a){Q(this,b);a=Z(b).call(this,a);if(!a||"object"!==typeof a&&"function"!==typeof a){if(void 0===this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=this}a.numberOfEventsSent=
0;return a}lc(b,a);T(b,[{key:"send",value:function(a){if(3>this.numberOfEventsSent)return this.numberOfEventsSent++,xa(Z(b.prototype),"send",this).call(this,a)}}]);return b}(fb),$c=function(){function a(b){Q(this,a);this.baseURL=b}T(a,[{key:"send",value:function(a){var b=this;return new Promise(function(c,f){if(Oc(a.action)){try{var d=JSON.stringify(a)}catch(K){f({message:"Unable to stringify event JSON: "+K})}var l=new XMLHttpRequest;l.onload=function(){if(200<=this.status&&300>this.status)try{var a=
JSON.parse(l.response);c(a)}catch(Sd){f({status:this.status,message:"Unable to parse response:"+l.response})}else f({status:this.status,statusText:l.statusText,message:l.responseText})};l.onerror=function(){f({status:this.status,statusText:l.statusText,message:l.responseText})};a.debug&&a.debug.explanations&&(l.withCredentials=!0);if("true"==Ob("isReadableEvent"))b.sendPost(l,b.baseURL,d);else try{if(!/^[\x20-\x7E]+$/.test(d))throw Error("GET request payload contains non-ASCII characters, try sending POST request");
var h=encodeURIComponent(window.btoa(d)),k=b.baseURL+"?event="+h;if(8192<k.length)throw Error("GET request URL exceeds 8192 characters, try sending POST request");b.sendGet(l,k)}catch(K){b.sendPost(l,b.baseURL,d)}}else f({message:"Event Rate Limiter triggered"})})}},{key:"sendGet",value:function(a,c){a.open("GET",c,!0);a.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");a.send()}},{key:"sendPost",value:function(a,c,d){a.open("POST",c,!0);a.setRequestHeader("Accept","application/json, text/javascript, */*; q=0.01");
a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");a.send("event="+encodeURIComponent(d))}}]);return a}(),Yc=function(a){Object.keys(a).forEach(function(b){var c=a[b];if("number"!=typeof c&&"boolean"!==typeof c&&null!=c)if("string"==typeof c){a:switch(b){case "url":case "urlref":c=c.substring(0,3072);break a;case "title":c=c.substring(0,1024);break a;default:c=c.substring(0,1024)}a[b]=c}else"function"==typeof c?delete a[b]:a[b]=JSON.stringify(c)})},Tb,Ub,Vb,Eb,fa,ha,gb=function(a){a[".bv"]=
16;a._ak=p.endpointConfig.account;a._ds=p.endpointConfig.dataset;a[".scv"]=p.endpointConfig.siteConfigVersion;a.channel="Web";a._r=String(Math.random()).slice(2,8)},hb=function(a){var b=O();a.userId?a._reqPersistedEntityIds="":b.persistedUserId&&(a._persistedUserId=b.persistedUserId);p.beaconConfig.trackAnonymousVisitors&&(a[".anonId"]=b.uuid,null!=b.affinityId&&(a[".aaId"]=b.affinityId),a.userId||a._persistedUserId||a._persistedAccountId||(a._anon="true"));return a},ia=function(a){a="".concat(a);
if(null==a||974>=a.length)return a;var b=731,c=244;974!=b+c&&(b+=974-(b+c));10<c?c-=5:10<b&&(b-=5);return a.substring(0,b)+" ... "+a.substring(a.length-c)},Wb=function(a,b){var c=b.header,d=b.fileName,f=b.line;b=b.column;c&&(a[".ef"]=ia(c));a[".eu"]=ia(d);a[".el"]=ia(f);a[".ec"]=ia(b);return a},ad=(fa={},C(fa,".eu","sourceURL"),C(fa,".el","line"),C(fa,".ec","column"),fa),bd=(ha={},C(ha,".eu","fileName"),C(ha,".el","lineNumber"),C(ha,".ec","columnNumber"),ha),Xb=function(a,b,c){return b?Wb(a,{header:!!b.stack&&
"string"===typeof b.stack&&b.stack.substring(0,b.stack.indexOf("@")),fileName:b[c[".eu"]],line:b[c[".el"]],column:b[c[".ec"]]}):a},cd=function(a){var b=Object.keys(a)[0];if(!b)return{};a=a[b];b={type:b,_id:a._id,name:a.name,url:a.url,imageUrl:a.imageUrl,description:a.description};a.price&&(b.priceDescription=a.priceDescription,b.price=a.price,b.listPrice=a.listPrice,b.currency=a.currency,b.inventoryCount=a.inventoryCount,b.alternateId=a.alternateId);Array.isArray(a.categories)&&(b.categories=a.categories.map(function(a){return"string"===
typeof a?{_id:a,type:r.ItemType.Category}:a}));if("object"===v(a.dimensions)){b.dimensions={};for(var c in a.dimensions)if(a.dimensions.hasOwnProperty(c)){var d=a.dimensions[c];Array.isArray(d)?b.dimensions[c]=d:b.dimensions[c]=[d]}}return b},ed=function(a){var b=[];Object.keys(a).forEach(function(c){b=b.concat(dd(c,a[c]))});return b},dd=function(a,b){return b.map(function(b){var c=fd(a);return{_id:b,type:c,tagType:"t"===c?a:void 0}})},fd=function(a){switch(a){case "Product":return"p";case "Article":return"a";
case "Blog":return"b";case "Category":return"c";case "Promotion":return"P";default:return"t"}},gd=function(a){var b={type:"e",id:a.experienceId,stat:Ua[a.stat],ug:a.control?"Control":void 0};a.catalog&&(b.piks=ed(a.catalog));return b},hd=function(a){var b={};b[".cStat"]=JSON.stringify(a.campaignStats.map(gd));gb(b);hb(b);Ub.send(b)},Ec=function(a,b){var c={};gb(c);hb(c);c[".em"]=ia(a.message||a);c[".es"]=b;var d=window.navigator.userAgent.toLowerCase();b="unknown";var f="";switch(!0){case -1<d.indexOf("edge"):b=
"ie";f="edge";break;case -1<d.indexOf("trident"):b="ie";f="trident";break;case -1<d.indexOf("chrome")&&!!window.chrome:f=b="chrome";break;case -1<d.indexOf("firefox"):f=b="mozilla";break;case -1<d.indexOf("safari"):f=b="safari"}"unknown"!==b?(d=(new RegExp("".concat(f,"/(.*?)s"),"gm")).exec(d),d=parseInt(!!d&&d[1]),d=isNaN(d)?null:d):d=null;c[".vt"]=b;d&&(c[".vn"]=d);switch(b){case "safari":Xb(c,a,ad);break;case "mozilla":Xb(c,a,bd);break;default:a&&a.stack&&"string"===typeof a.stack&&(a=a.stack.split("\n")[1],
a=a.substring(a.indexOf("at ")+3).match(/(.*) \((.*):(\d+):(\d+)\)/),Array.isArray(a)&&Wb(c,{header:a[1],fileName:a[2],line:a[3],column:a[4]}))}return c};(function(a){a.ViewItem="View Item";a.ViewItemOutOfStock="View Item Out Of Stock";a.ViewItemDetail="View Item Detail";a.QuickViewItem="Quick View Item";a.StopQuickViewItem="Stop Quick View Item";a.ViewCategory="View Category";a.ViewTag="View Tag";a.AddToCart="Add To Cart";a.ViewCart="View Cart";a.Purchase="Purchase";a.Share="Share";a.Review="Review";
a.Comment="Comment";a.Favorite="Favorite";a.Search="Search";a.SearchViewResults="Search View Results";a.SearchClick="Search Click";a.ClickThrough="Click Through";a.UpdateLineItem="Update Line Item";a.RemoveFromCart="Remove From Cart";a.ViewBanditItems="View Bandit Items"})(r.ItemAction||(r.ItemAction={}));var kd=function(a){id(a);jd(a);n.onEventSend.emit(a);switch(a.itemAction){case r.ItemAction.QuickViewItem:h.result=w({},h.result,{backgroundPage:h.result.backgroundPage||h.result.currentPage,currentPage:w({},
a,{action:a.action||r.ItemAction.QuickViewItem,itemAction:r.ItemAction.QuickViewItem})});break;case r.ItemAction.StopQuickViewItem:h.result=w({},h.result,{backgroundPage:null,currentPage:h.result.backgroundPage||h.result.currentPage})}return new Promise(function(b,c){Tb.send(a).then(function(c){var d=O(),g=c.persistedUserId,l=c.anonAffinityId;if(g){var h=g.entityId;g=g.accountId;h&&(d.persistedUserId=h);g&&(d.persistedAccountId=g)}l&&l!==d.affinityId&&(d.affinityId=l);Gb(d);t.debug("Received event response: ",
c);n.onEventResponse.emit(c,a);n.onDeprecatedEventResponse.emit(c);b(c)})})},id=function(a){var b=a.flags;a.source=a.source||{};var c=a.source||{},d;(d=a.source.pageType)||(d=h.result.currentPage&&h.result.currentPage.source?h.result.currentPage.source.pageType:void 0);a.source=w({},c,{pageType:d,url:a.source.url||window.location.href,urlReferrer:a.source.urlReferrer||document.referrer,channel:a.source.channel||"Web",contentZones:ld(a.source,(b||{}).pageView),time:a.source.time,configVersion:p.endpointConfig.siteConfigVersion,
beaconVersion:16});b=O();a.user=w({},a.user||{},{anonId:b.uuid});b.persistedUserId&&(a.user.encryptedId=b.persistedUserId);b=O();a.account=a.account||{};b.persistedAccountId&&(a.account.encryptedId=b.persistedAccountId);if(b=Sb.getParameterByName("evergageTestMessages"))a.debug?a.debug.testMessages=b:a.debug={testMessages:b}},ld=function(a,b){return(a.contentZones||[]).reduce(function(a,d){!b&&"object"===v(d)&&(d||{}).name&&t.warn("Using content zone objects in 'sendEvent' will soon be deprecated in favor of zone names as strings");
d="string"===typeof d&&""!==d?d:(d||{}).name;"string"===typeof d&&""!==d&&a.push(d);return a},[])},jd=function(a){a.catalog&&0<Object.keys(a.catalog).length&&Object.keys(a.catalog).forEach(function(b){if(a.catalog[b]&&a.catalog[b].dimensions){var c=a.catalog[b].dimensions;Object.keys(c).forEach(function(a){if(!Array.isArray(c[a]))return n.onFireException.emit(Error("".concat(a," is not an array. Dimensions must have type of string[]")),"Sitemap"),!1})}});return!0},ib=function(a){a:{var b=a,c=h.result.matchedConfig;
try{b=c&&c.onActionEvent?c.onActionEvent(b):b;if("object"===v(b)){a=b;break a}n.onFireException.emit(Error("onActionEvent failed for the ".concat(h.result.matchedConfig.name," page config. Must return an object or null.")),"Site-wide Javascript")}catch(d){n.onFireException.emit(Error("onActionEvent failed for the ".concat(h.result.matchedConfig.name," page config. ").concat(d.message,".")),"Site-wide Javascript")}a=void 0}a:{b=a;c=h.config;try{b=c.global&&c.global.onActionEvent?c.global.onActionEvent(b):
b;if("object"===v(b)){a=b;break a}n.onFireException.emit(Error("onActionEvent failed for the global page config. Must return an object or null."),"Site-wide Javascript")}catch(d){n.onFireException.emit(Error("onActionEvent failed for the global page config. ".concat(d.message,".")),"Site-wide Javascript")}a=void 0}return p.beaconConfig.sendEvents?kd(a):Promise.resolve(a)},Bc=function(a){if(p.beaconConfig.sendEvents){var b={};b[".top"]=""+a.timeOnPageMillis;a.catalog&&0<Object.keys(a.catalog).length&&
(b.item=JSON.stringify(cd(a.catalog)));a.action&&(b.action=a.action);gb(b);hb(b);Vb.send(b);a=void 0}else a=Promise.resolve(a);return a},Na=function(a,b){var c={_id:null},d=!0,f=!1,g=void 0;try{for(var l=b[Symbol.iterator](),h;!(d=(h=l.next()).done);d=!0){var k=h.value;"undefined"!==typeof a[k]&&Object.assign(c,C({},k,a[k]))}}catch(K){f=!0,g=K}finally{try{d||null==l.return||l.return()}finally{if(f)throw g;}}return c},va,md=function(){jb();Yb()&&(va=setInterval(function(){var a=!1,b=(new Date).getTime(),
c=h.result.matchedConfig.listeners.map(function(b){if(b.selectorFound)return b;b=Zb(b);a=b.selectorFound||a;return b}),d=h.result.matchedConfig.contentZones.map(function(b){if(b.selectorFound)return b;b=kb(b);a=b.selectorFound||a;return b});a&&Object.assign(h.result.matchedConfig,w({},h.result.matchedConfig,{contentZones:d,listeners:c}));(50<(new Date).getTime()-b||!Yb())&&jb()},1E3))},Yb=function(){if(h.result.matchedConfig){var a=h.result.matchedConfig,b=a.listeners;a=a.contentZones;return b&&a?
b.filter(function(a){return!a.selectorFound}).length||a.filter(function(a){return!a.selectorFound}).length:!1}return!1},jb=function(){"number"===typeof va&&clearInterval(va);va=null},Zb=function(a){var b=k(a.selector),c=w({},a,{selectorFound:0<b.length});b.on(c.bind,function(a){if(c.options)t.warn("ListenerOptions are deprecated. Please use a callback in the Listener instead."),a=w({},c.options,{user:{}}),ib(a);else try{c.callback(a)}catch(f){n.onFireException.emit(Error("Listener callback on ".concat(c.bind,
" bound to ").concat(c.selector," failed for the ").concat(h.result.matchedConfig.name," page config. ").concat(f.message,".")),"Site-wide Javascript")}});return c},kb=function(a){var b=!(a||{}).selector||0<k((a||{}).selector).length;return w({},a,{selectorFound:b})},nd=function(){h.result&&h.result.matchedConfig&&h.result.matchedConfig.listeners&&h.result.matchedConfig.listeners.forEach(function(a){k(a.selector).off(a.bind)})},od={_id:!0,currency:!0,inventoryCount:!0,price:!0,tagType:!0,type:!0},
$b=function(){var a=0<k('script[src*="//translate.googleusercontent.com"]').length,b=0<k("html.translated-ltr").length||0<k("html.translated-rtl").length;if(a||b)return t.debug("page is translated"),!0;try{var c=0<k(window.parent.document).find('script[src*="//www.microsofttranslator.com"]').length,d=0<k(window.parent.document).find('frame[src*="//www.worldlingo.com"]').length;if(c||d)return t.debug("page is translated"),!0;t.debug("page is not translated");return!1}catch(f){return t.debug("exception caught, assuming page is untranslated "+
f),!1}},pd=function(a){$b()&&Object.keys(a).forEach(function(b){var c=a[b];Object.keys(c).forEach(function(a){od[a]||delete c[a]})});return a},bc=function(a){return new Promise(function(b,c){var d=h.config.pageTypeDefault;d&&ja({pageName:d.name,status:E.Pending});d&&!a.length?(lb(d),b(d)):(qd(a),a.map(function(f){rd(f).then(function(g){g?(d&&ac(d),lb(f),b(f)):(ac(f),sd(a)||(d?(lb(d),b(d)):c("No matching page found")))}).catch(function(a){n.onFireException.emit(Error("isMatch failed while evaluating the ".concat(f.name,
" page config")),"Site-wide Javascript")})}))})},td=function(){var a=h;a.result.matchStatus&&(a.result.matchStatus.forEach(function(a){a.status===E.Running&&a._reject()}),h.result.matchStatus=[]);n.onPageMatchStatusUpdated.emit(h.result.matchStatus)},qd=function(a){a.forEach(function(a){ja({pageName:a.name,status:E.Pending})})},lb=function(a){ja({pageName:a.name,endTime:Date.now(),status:h.result.matchStatus.find(function(a){return a.status===E.Selected})?E.Matched:E.Selected})},ac=function(a){ja({pageName:a.name,
status:E.Rejected,endTime:Date.now()})},sd=function(a){return h.result.matchStatus.filter(function(a){return a.status===E.Rejected},0).length<a.length},rd=function(a){return new Promise(function(b,c){ja({pageName:a.name,status:E.Running,startTime:Date.now(),_reject:c});"function"===typeof a.isMatch?(c=a.isMatch(),"object"===v(c)?c.then(function(a){b(a)}).catch(function(){}):b(c)):n.onFireException.emit(Error("isMatch failed while evaluating the ".concat(a.name," page config. isMatch must be a function.")),
"Site-wide Javascript")})},ja=function(a){h.result.matchStatus=[].concat(ka(h.result.matchStatus||[]),[a]);n.onPageMatchStatusUpdated.emit(h.result.matchStatus)},ud=function(a,b){return new Promise(function(b,d){n.onInitSitemap.once(function(){return d("sitemap_reinit")});J(a,"lineItems",!1,!0).then(function(a){var c={complete:{Product:[]}};0===Object.keys(a).length&&b(c);a=J(a,"lineItems",!0,!1);c.complete.Product=a;b(c)}).catch(function(a){n.onFireException.emit(Error("Cart Config was rejected"),
"Site-wide Javascript")})})},J=function(a,b,c,d){try{h.config.currentKey=b;if(a)if("dimensions"!==b&&"lineItems"!==b&&"attributes"!==b||!d){var f="function"===typeof a?a():a;"categories"===b&&Array.isArray(f)&&"object"!==v(f[0])&&"c"!==f[0].type&&"string"!==typeof f[0]._id?f=vd(f):"lineItems"===b&&"object"===v(f)&&(f=wd(f))}else f=xd(a,b);return c?mb(b,f,h.config.settings.canonicalizeIds):f}catch(g){n.onFireException.emit(Error("getValue for ".concat(b," failed on ").concat(h.result.matchedConfig.name,
" while evaluating custom function. ").concat(g.message,".")),"Site-wide Javascript")}},cc=function(a,b,c){if(a&&"object"===v(a)&&"function"===typeof a.then)n.onFireException.emit(Error("getValue for ".concat(b," failed on ").concat(h.result.matchedConfig.name," while evaluating custom function. ").concat(b," cannot be a Promise.")),"Site-wide Javascript");else if(a||"number"===typeof a||"boolean"===typeof a)c[b]=a},yd=function(a,b){return new Promise(function(c,d){n.onInitSitemap.once(function(){return d("sitemap_reinit")});
for(var f=Object.keys(Va),g=[],l=0;l<f.length;l++){var h=f[l];h=J(a[h],h,!1,!0);g.push(h)}Promise.all(g).then(function(d){var g={_id:null};d.forEach(function(a,b){b=f[b];a=J(a,b,!0,!1);cc(a,b,g)});Object.keys(a).forEach(function(b){if(!f.includes(b)){var c=J(a[b],b,!0,!0);cc(c,b,g)}});d=C({},b,g);c(d)}).catch(function(a){n.onFireException.emit(Error("Catalog Config was rejected"),"Site-wide Javascript")})})},zd=function(a){return new Promise(function(b,c){n.onInitSitemap.once(function(){return c("sitemap_reinit")});
var d=[],f=Object.keys(a);f.forEach(function(b){h.config.currentKey=b;b=J(a[b],b,!1,!0);d.push(b)});Promise.all(d).then(function(a){var c={},d={Product:{}};a.forEach(function(a,b){b=f[b];a=J(a,b,!0,!1);c[b]=a});d.Product=c;b(d)}).catch(function(a){n.onFireException.emit(Error("Order Config was rejected"),"Site-wide Javascript")})})},wd=function(a){var b;a._id?b=a._id.length:a.sku?b=a.sku.length:n.onFireException.emit(Error("Either _id or sku must be defined for lineItems"),"Sitemap");for(var c=[],
d=function(){var a=aa(g[f],2),d=a[0];a=a[1];a.length!=b?n.onFireException.emit(Error("Resolving multiple values for ".concat(d," failed on ").concat(h.result.matchedConfig.name,". ").concat(d," does not have the same number of values as _id")),"Site-wide Javascript"):a.forEach(function(a,b){c[b]||(c[b]={_id:null,quantity:null});c[b][d]=a})},f=0,g=Object.entries(a);f<g.length;f++)d();return c},vd=function(a){return a.map(function(a){return{type:"c",_id:a}})},xd=function(a,b){var c={},d=Object.keys(a),
f={};d.forEach(function(b){var d=J(a[b],b,!1,!0);c[b]=d});return"lineItems"===b||"dimensions"===b?Promise.all(Object.values(c)).then(function(a){a.forEach(function(a,b){b=d[b];(a=J(a,b,!1,!1))&&(f[b]=a)});return f}):c},mb=function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,d=b;return d=Array.isArray(b)?"lineItems"===a?Ad(b,c):b.map(function(b){return dc(a,b,c)}):dc(a,b,c)},Ad=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0;return a.map(function(a){return Bd(a,
b)})},Bd=function(a){var b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0,c;for(c in a)if("item"===c)for(var d in a[c])a[c][d]=mb(d,a[c][d],b);else a[c]=mb(c,a[c],b);return a},dc=function(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:!0,d=b;"price"!==a&&"listPrice"!==a&&"totalValue"!==a&&"rating"!==a||"string"!==typeof d||(d=db(d));if("url"===a||"imageUrl"===a)d=cb(d);"_id"!==a&&"sku"!==a&&"orderId"!==a||"number"!==typeof d||(d=d.toString());!c||"string"!==typeof d||
"_id"!==a&&"sku"!==a&&"orderId"!==a&&"alternateId"!==a&&"parentId"!==a||(d=d.toUpperCase());"string"===typeof d&&(0<=d.indexOf("&")&&(c=document.createElement("textarea"),Object.assign(c,{innerHTML:d}),d=c.value),d=d.trim());"description"===a&&"string"===typeof d&&200<d.length&&(d=d.substr(0,197)+"...");"quantity"!==a&&"inventoryCount"!==a&&"numRatings"!==a||"string"!==typeof d||(d=Rb(d));return d},ec=function(a){a.global=a.global||{};"object"!=v(a.global)&&n.onFireException.emit(Error("The global config has a type of ".concat(v(a.global),
", but it must be an object")),"Sitewide Javascript");Object.assign(h.config,w({},a));n.onInitSitemap.emit(h.config)},gc=function(a){fc(a);return!0},Db=function(){return h.result.currentPage||{}},hc=function(a){h.result.matchedConfig=w({},a,{contentZones:Cd(a),listeners:Dd(a)});var b=h.result,c=h.result.currentPage||{};var d="function"===typeof a.action?a.action():a.action;var f=a.catalog?a.itemAction||r.ItemAction.ViewItem:null,g=a.name;var l="function"===typeof a.locale?a.locale():a.locale;b.currentPage=
w({},c,{action:d,itemAction:f,source:{pageType:g,locale:l,contentZones:Ed(a)},flags:{pageView:!0},user:{},performance:{},debug:{}});return Fd(a)},Fd=function(a){return a.itemAction===r.ItemAction.ViewCart||a&&a.cart&&a.cart.complete?Gd(a).then(function(a){h.result.currentPage.itemAction=r.ItemAction.ViewCart;h.result.currentPage.cart=a}):a.itemAction===r.ItemAction.Purchase||a&&a.order?Hd(a).then(function(a){h.result.currentPage.itemAction=r.ItemAction.Purchase;h.result.currentPage.order=a}):Id(a).then(function(a){h.result.currentPage.catalog=
a})},Gd=function(a){var b={};if(!a.catalog&&!a.cart&&!a.order)return Promise.resolve(b);if(a.cart)var c=a.cart;else if(a.order||a.catalog){var d={},f=a.order||a.catalog;Object.keys(f).forEach(function(a){var b=f[a];b&&b.lineItems&&(d[a]=b.lineItems)});c={complete:d}}if(c.complete){a=c.complete;for(var g in a)return Array.isArray(g.match(/[A-Z]/))?"Product"!==g?(n.onFireException.emit(Error("Item type must be Product"),"Sitewide Javascript"),Promise.resolve(b)):ud(a[g],g):(n.onFireException.emit(Error("Item types must be capitalized. Did you mean ".concat(g.replace(/^\w/,
function(a){return a.toUpperCase()}),"?")),"Sitewide Javascript"),Promise.resolve(b))}},Hd=function(a){var b={};if(!a.catalog&&!a.order)return Promise.resolve(b);a=a.order||a.catalog;for(var c in a)return Array.isArray(c.match(/[A-Z]/))?"Product"!==c?(n.onFireException.emit(Error("Item type must be Product"),"Sitewide Javascript"),Promise.resolve(b)):zd(a[c]):(n.onFireException.emit(Error("Item types must be capitalized. Did you mean ".concat(c.replace(/^\w/,function(a){return a.toUpperCase()}),"?")),
"Sitewide Javascript"),Promise.resolve(b))},Id=function(a){var b={};if(!a.catalog)return Promise.resolve(b);for(var c in a.catalog)return Array.isArray(c.match(/[A-Z]/))?Jd(a.catalog[c],c):(n.onFireException.emit(Error("Item types must be capitalized. Did you mean ".concat(c.replace(/^\w/,function(a){return a.toUpperCase()}),"?")),"Sitewide Javascript"),Promise.resolve(b))},Jd=function(a,b){return yd(a,b).then(function(a){Object.keys(a).forEach(function(c){a[c]._id||n.onFireException.emit(Error("Invalid ".concat(b,
", missing _id for the ").concat(h.result.matchedConfig.name," page config.")),"Site-wide Javascript")});return h.config.settings.truncateTranslated?pd(a):a})},Cd=function(a){return(a.contentZones||[]).reduce(function(a,c){c=kb(c);"string"===typeof(c||{}).name&&""!==(c||{}).name&&a.push(c);return a},[])},Ed=function(a){return(a.contentZones||[]).reduce(function(a,c){c=kb(c);"string"===typeof(c||{}).name&&""!==(c||{}).name&&a.push((c||{}).name);return a},[])},Dd=function(a){return(a.listeners||[]).map(function(a){return Zb(a)})},
Kd=function b(){for(var c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];return d.reduce(function(c,d){Object.keys(d).forEach(function(f){var g=c[f],h=d[f];Array.isArray(g)&&Array.isArray(h)?Object.assign(c,C({},f,g.concat.apply(g,ka(h)))):g&&"object"===v(g)&&h&&"object"===v(h)?Object.assign(c,C({},f,b(g,h))):Object.assign(c,C({},f,h))});return c},{})},ic=function(b){var c=h.config.global||{},d=c.onActionEvent;delete c.onActionEvent;b=Kd(c,b);c.onActionEvent=d;return b},Od=function(b){try{return Ld(b.global),
Md(b.pageTypeDefault),Nd(b.pageTypes),!0}catch(c){return n.onFireException.emit(Error(c),"Sitemap"),!1}},Md=function(b){b&&Object.keys(b).forEach(function(b){if("contentZones"!==b&&"listeners"!==b&&"locale"!==b&&"name"!==b&&"onActionEvent"!=b)throw Error("".concat(b," is not a valid default config attribute."));})},Ld=function(b){b&&Object.keys(b).forEach(function(b){if("contentZones"!==b&&"listeners"!==b&&"locale"!==b&&"onActionEvent"!=b)throw Error("".concat(b," is not a valid global config attribute."));
})},Nd=function(b){b.forEach(function(b){if(!b.name||!b.isMatch)throw Error("All page configs must have a name and isMatch attribute defined");})},Pd=function(){var b=h.result;ib(h.result.currentPage);h.result=b},fc=function(b){ec(b);nd();td();jb();(h.config.settings.runOnTranslatedPage||!$b())&&Od(b)&&bc(b.pageTypes).then(ic).then(hc).then(Pd).then(md).catch(function(b){"sitemap_reinit"!==b&&n.onFireException.emit(Error("Unhandled exception: ".concat(b)),"Site-wide Javascript")})},x=0,A=-1,G,H,Ja,
Qd={setupActivityTimers:Bb,activityRegistered:da,setUserInactive:ra},B=function(b,c){if(b)try{return b(c)}catch(d){return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name," inside of the custom transform function. ").concat(d)),"Site-wide Javascript"),null}return c},Rd=k,Oa,Pa,Qa,Ra,Sa,jc=function(){return w({},p.endpointConfig,{},p.beaconConfig)},kc=function(b){var c=document.dispatchEvent(new CustomEvent(M.OnInit,{detail:{beaconConfig:w({},
p.beaconConfig,{},p.endpointConfig,{},b)},cancelable:!0}));return new Promise(function(d){if(c){if(Jc(window.navigator.userAgent||"")?R("You are a robot."):"prerender"===document.visibilityState&&Kc?R("Page is pre-rendered and loaded in Safari."):1){var f=p.endpointConfig,g=f.account,h=f.dataset;p.beaconConfig=w({},p.beaconConfig,{trackerUrl:f.trackerUrl},b);f=p.beaconConfig.cookieDomain;f||(f=window.location.hostname);I.setCookieHash(g,h,f);Ya.setStorageKeyPrefix(g,h);var k=I.read("a");f=I.read("n");
k&&"object"===v(k)&&0<Object.keys(k).length?(p.visitor=w({},p.visitor,{},{uuid:k.uuid,affinityId:k.affinityId,persistedUserId:k.puid,persistedAccountId:k.paid}),t.debug("Loaded visitor record from cookie: ".concat(JSON.stringify(O())))):"string"===typeof k&&0<k.length||null!=f&&"object"===v(f)?(k&&"object"!==v(k)&&(k=k.split("."),0<k.length&&(p.visitor.uuid=k[0],1<k.length&&k[1]&&(p.visitor.affinityId=k[1])),I.remove("a",{domain:p.beaconConfig.cookieDomain}),I.remove("a",{domain:Hb(location.hostname)})),
f&&"object"===v(f)&&(f.puid&&"string"===typeof f.puid&&(p.visitor.persistedUserId=f.puid),f.paid&&"string"===typeof f.paid&&(p.visitor.persistedAccountId=f.paid),I.remove("n",{domain:p.beaconConfig.cookieDomain}),I.remove("n",{domain:Hb(location.hostname)})),t.debug("Classic cookie detected with anonymousId: ".concat(O().uuid))):(f=p.visitor,k=(window.navigator.userAgent||"")+(window.navigator.platform||"")+(new Date).getTime+JSON.stringify({})+Math.random(),k=za(k).slice(0,16),f.uuid=k,t.debug("Created new visitor record. anonymousId: ".concat(O().uuid)));
f=O();Gb(f);t.trace("Refreshing session");Ya.read("sessionTicket")||Ya.write("sessionTicket","*");f=p.beaconConfig.trackerUrl;Tb=new $c(f+"/api2/event/"+p.endpointConfig.dataset);Ub=new fb(f+"/msreceiver");Vb=new fb(f+"/pr");Eb=new Zc(f+"/er");Dc();Qd.setupActivityTimers();if("shutDown"!==p.beaconState)return t.debug("Initialized Tracking Beacon v".concat(16," for account[").concat(g,"] dataset[").concat(h,"]")),sa("running"),d(p),!0}}else t.debug("Cancelling activity tracking."),clearTimeout(G),
G=-1,L(window,"unload",Ka),L(window,"blur",La),L(window,"focus",Ma),L(document,"mousemove keydown scroll click",da),t.debug("Initialization aborted onBeforeInitHook() returned false.")})};r.CustomEvents=M;r.addEventListener=function(b){t.warn("Evergage.addEventListener is deprecated. Use the Evergage.CustomEvents.OnEventSend event instead.");return null};r.addResponseListener=function(b){t.warn("Evergage.addResponseListener is deprecated. Use the Evergage.CustomEvents.OnEventReponse event instead.");
return n.onDeprecatedEventResponse.on(b)};r.build=function(b){bc(b.pageTypes).then(ic).then(hc).catch(function(b){"sitemap_reinit"!==b&&n.onFireException.emit(Error("Unhandled exception: ".concat(b)),"Site-wide Javascript")})};r.cashDom=Rd;r.configure=function(b,c){if("running"==p.beaconState){t.debug("Unbinding signal subscriptions.");try{n.unbindAll()}catch(g){t.debug("Failed to unbind Experience.Signals",g)}}sa("initializing");p.endpointConfig=w({},p.endpointConfig,{},b);var d=p.endpointConfig;
b=d.account;var f=d.dataset;d=d.siteConfigVersion;if(!b||!f)return R("account/dataset undefined. Check your beacon configuration.");if(!d)return R("beacon config version undefined");p.endpointConfig.cdnUrl||(p.endpointConfig.cdnUrl="https://".concat(Fc));if(!p.endpointConfig.cdnUrl)return R("cdnUrl undefined. Check your beacon configuration.");p.endpointConfig.trackerUrl||(d=p.endpointConfig,b="https://".concat({account:b,dataset:f}.account,".").concat("evergage.com"),d.trackerUrl=b);if(!p.endpointConfig.trackerUrl)return R("trackerUrl undefined. Check your beacon configuration.");
p.beaconConfig=w({},p.beaconConfig,{},c);sa("configured")};r.getConfig=jc;r.getContentZoneSelector=function(b){var c=(h.result.matchedConfig||{}).contentZones;return c?(c=c.find(function(c){return c.name===b}))&&c.selector?c.selector:null:null};r.getCurrentPage=Db;r.getLoggingLevel=function(){return t.getLoggingLevel()};r.getState=function(){return h};r.getVersion=function(){return 16};r.init=kc;r.initSitemap=gc;r.listener=function(b,c,d){return"object"===v(d)?{bind:b,selector:c,options:d}:"function"===
typeof d?{bind:b,selector:c,callback:d}:null};r.log=t;r.onBeforeInit=function(b,c){t.warn("Evergage.onBeforeInit is deprecated. Use the Evergage.CustomEvents.OnInit event instead.");b(p.endpointConfig,{});return!1};r.reinit=function(){kc(jc()).then(function(){gc(h.config)})};r.resolvers={fromSelector:function(b,c){return function(){if("string"!=typeof b)return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name,". Selector must be a string.")),
"Site-wide Javascript"),null;var d=k(b).first().text();return d=B(c,d)}},fromSelectorAttribute:function(b,c,d){return function(){if("string"!=typeof b)return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;if("string"!=typeof c)return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name,". Attribute must be a string.")),
"Site-wide Javascript"),null;var f=k(b).first().attr(c);return f=B(d,f)}},fromSelectorMultiple:function(b,c){return function(){if("string"!=typeof b)return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;var d=k(b).get().map(function(b){return k(b).text()});return d=B(c,d)}},fromSelectorAttributeMultiple:function(b,c,d){return function(){if("string"!=typeof b)return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey,
" failed on ").concat(h.result.matchedConfig.name,". Selector must be a string.")),"Site-wide Javascript"),null;if("string"!=typeof c)return n.onFireException.emit(Error("getValue for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name,". Attribute must be a string.")),"Site-wide Javascript"),null;var f=k(b).get().map(function(b){return k(b).attr(c)});return f=B(d,f)}},fromItemProp:function(b,c){return function(){var d=k("[itemprop='"+b+"']").first().attr("content");return d=
B(c,d)}},fromMeta:function(b,c){return function(){var d=k("meta[name='"+b+"']").first().attr("content")||k("meta[property='"+b+"']").first().attr("content");return d=B(c,d)}},fromWindow:function(b,c){return function(){var d=eb(b);return d=B(c,d)}},fromJsonLd:function(b,c){return function(){var d=k("script[type='application/ld+json']").first().text();try{var f=JSON.parse(d);if(b){var g=eb(b,f);return B(c,g)}return B(c,f)}catch(l){n.onFireException.emit(Error("Parsing JSON-LD for ".concat(h.config.currentKey,
" failed on ").concat(h.result.matchedConfig.name,". ").concat(l)),"Site-wide Javascript")}}},fromCanonical:function(b){return function(){var c=k("link[rel=canonical]").attr("href");return c=B(b,c)}},fromHref:function(b){return function(){var c=window.location.href;return c=B(b,c)}},buildCategoryId:function(b,c,d,f){return function(){var g=Array.from(k(b));c&&(g=g.slice(c));d&&(g=g.slice(0,-1));var l=[];g.forEach(function(b){(b=k(b).text().trim())?l.push(b):n.onFireException.emit(Error("buildCategoryId for ".concat(h.config.currentKey,
" failed on ").concat(h.result.matchedConfig.name,". A category part is null.")),"Site-wide Javascript")});g=l.join("|");return g=B(f,g)}},buildCategoryIdAttribute:function(b,c,d,f,g){return function(){var l=Array.from(k(b));d&&(l=l.slice(d));f&&(l=l.slice(0,-1));var m=[];l.forEach(function(b){(b=k(b).attr(c).trim())?m.push(b):n.onFireException.emit(Error("buildCategoryId for ".concat(h.config.currentKey," failed on ").concat(h.result.matchedConfig.name,". A category part is null.")),"Site-wide Javascript")});
l=m.join("|");return l=B(g,l)}}};r.runSpecificConfig=function(b){Object.assign(h.config,{pageTypes:[b]});fc(h.config)};r.sendEvent=ib;r.sendException=ea;r.sendStat=function(b){b.campaignStats.forEach(function(b){var c=h.campaignResponses.find(function(c){return c.experienceId===b.experienceId});n.onStatSend.emit(b,c)});return p.beaconConfig.sendEvents?hd(b):Promise.resolve(b)};r.setConfig=ec;r.setLoggingLevel=function(b){t.setLoggingLevel(b)};r.shutDown=R;r.util=Sb;return r}({});

(function configureEvergage() {
    try {
       Evergage.configure({
           account: "reckittbenckiser",
           dataset: "engage",
           cdnUrl: "https://cdn.evergage.com",
           trackerUrl: "https://reckittbenckiser.us-1.evergage.com",
           siteConfigVersion: "133"
       },{"allowBotTraffic":false,"corsAllowedOrigins":["*"],"defaultCurrency":"USD","defaultLocale":null,"disableQtipWindowScroll":false,"doNotStoreCookiesRequireProvidedAnonId":false,"doNotTrackPingRequestsForActions":false,"enableCorsRestrictedOrigins":false,"enableMessageRotation":false,"enableRememberMeUserIds":false,"enableTemplateEsc":false,"hideContentSections":false,"hideContentSectionsMillis":2500,"hidePagesForRedirect":false,"hidePagesForRedirectMillis":1000,"lastModified":1602071911923,"preventSensitiveDataCapture":false,"rememberMeUserIdsMillis":63072000000,"sendErrorEvents":true,"showPoweredBy":false,"siteConfigExecBeforePageReady":false,"spaRouteChangeTimeout":500,"trackAnonymousVisitors":true,"trackContextualRelatedItems":false,"trackSubdomainAsCompany":false,"trackUnknownPagesByTitle":false,"treatHashChangeAsPageLoad":false}       );
    } catch (e) {
          console.error(e);
    }
})();


try {
    const CAMPAIGN_STAT_ATTRIBUTE = {
    CAMPAIGN: "data-evg-campaign-id",
    EXPERIENCE: "data-evg-experience-id",
    USER_GROUP: "data-evg-user-group",
    CLICKTHROUGH: "data-evg-clickthrough",
    IGNORE_CLICKTHROUGH: "data-evg-ignore-clickthrough",
    DISMISSAL: "data-evg-dismissal",
    ITEM: "data-evg-item-id",
    ITEM_TYPE: "data-evg-item-type"
};

const CAMPAIGN_STAT_TYPE = {
    IMPRESSION: "Impression",
    CLICKTHROUGH: "Clickthrough",
    DISMISSAL: "Dismissal"
};

const CAMPAIGN_STAT_USER_GROUP = {
    TEST: "Test",
    CONTROL: "Control"
};

document.addEventListener(Evergage.CustomEvents.OnTemplateDisplayEnd, (event) => {
    if (validateOnTemplateDisplayEndEvent(event)) {
        const payload = event.detail.payload;
        const campaignElement = getCampaignElementFromPayload(payload);
        sendImpression(payload, campaignElement);
        bindCampaignClickthroughsAndDismissals(campaignElement);
    }
});

const sendImpression = (payload, campaignElement) => {
    const userGroup = payload.userGroup;
    const stat = {
        control: userGroup === CAMPAIGN_STAT_USER_GROUP.CONTROL,
        experienceId: payload.experience,
        stat: CAMPAIGN_STAT_TYPE.IMPRESSION
    };
    const itemStats = generateItemStats(campaignElement);
    if (Object.keys(itemStats).length > 0) {
        stat.catalog = itemStats;
    }
    if (userGroup === CAMPAIGN_STAT_USER_GROUP.CONTROL || (userGroup === CAMPAIGN_STAT_USER_GROUP.TEST && campaignElement.length > 0)) {
        Evergage.sendStat({campaignStats: [stat]});
    } else {
        Evergage.log.warn("campaignStatsTracking.js", "Experience", payload.experience, "not found in DOM.");
    }
};

const generateItemStats = (campaignElement) => {
    const catalogStats = {};
    const itemNodes = Evergage.cashDom(campaignElement).find("[" + CAMPAIGN_STAT_ATTRIBUTE.ITEM_TYPE + "]");
    if (!itemNodes || itemNodes.length === 0) {
        return catalogStats;
    }
    Array.from(itemNodes).forEach(function(itemNode) {
        const itemId = Evergage.cashDom(itemNode).attr(CAMPAIGN_STAT_ATTRIBUTE.ITEM);
        const itemType = Evergage.cashDom(itemNode).attr(CAMPAIGN_STAT_ATTRIBUTE.ITEM_TYPE);
        if (itemId && itemType) {
            if (!catalogStats[itemType]) {
                catalogStats[itemType] = [];
            }
            catalogStats[itemType].push(itemId);
        }
    });
    return catalogStats;
}

const getCampaignElementFromPayload = (payload) => {
    const experienceId = payload.experience;
    const campaignSelector = "[" + CAMPAIGN_STAT_ATTRIBUTE.EXPERIENCE + "=" + "'" + experienceId + "'" + "]";
    return Evergage.cashDom(campaignSelector);
};

const getCampaignClickthroughAndDismissalElements = (campaignElement) => {
    return Evergage.cashDom(campaignElement).find(`
        a,
        [${CAMPAIGN_STAT_ATTRIBUTE.CLICKTHROUGH}],
        [${CAMPAIGN_STAT_ATTRIBUTE.DISMISSAL}]
    `);
};

const sendClickthroughOrDismissal = (e) => {
    if (Evergage.cashDom(e.target).closest(`[${CAMPAIGN_STAT_ATTRIBUTE.IGNORE_CLICKTHROUGH}]`).length > 0) {
        return;
    }
    const campaignElement = Evergage.cashDom(e.target).closest(`[${CAMPAIGN_STAT_ATTRIBUTE.EXPERIENCE}]`);
    if (campaignElement.length > 0  && Evergage.cashDom(e.target).closest(`
        a,
        [${CAMPAIGN_STAT_ATTRIBUTE.CLICKTHROUGH}],
        [${CAMPAIGN_STAT_ATTRIBUTE.DISMISSAL}]`).length > 0) {

        const stat = {
            control: campaignElement.attr(CAMPAIGN_STAT_ATTRIBUTE.USER_GROUP) === CAMPAIGN_STAT_USER_GROUP.CONTROL,
            experienceId: campaignElement.attr(CAMPAIGN_STAT_ATTRIBUTE.EXPERIENCE),
            stat: Evergage.cashDom(e.target).closest(`[${CAMPAIGN_STAT_ATTRIBUTE.CLICKTHROUGH}]`).length > 0 || Evergage.cashDom(e.target).closest("a").length > 0
                ? CAMPAIGN_STAT_TYPE.CLICKTHROUGH
                : CAMPAIGN_STAT_TYPE.DISMISSAL
        };

        if (stat.stat === CAMPAIGN_STAT_TYPE.CLICKTHROUGH) {
            const itemClickthroughStats = generateItemClickthroughStats(e.target);
            if (Object.keys(itemClickthroughStats).length > 0) {
                stat.catalog = itemClickthroughStats;
            }
        }

        Evergage.sendStat({campaignStats: [stat]});
    }
};

const generateItemClickthroughStats = (target) => {
    const itemStats = {};
    const itemId = Evergage.cashDom(target).closest("[" + CAMPAIGN_STAT_ATTRIBUTE.ITEM + "]").attr(CAMPAIGN_STAT_ATTRIBUTE.ITEM);
    const itemType = Evergage.cashDom(target).closest("[" + CAMPAIGN_STAT_ATTRIBUTE.ITEM_TYPE + "]").attr(CAMPAIGN_STAT_ATTRIBUTE.ITEM_TYPE);

    if (itemId && itemType) {
        itemStats[itemType] = [itemId];
    }
    return itemStats;
}

const bindCampaignClickthroughsAndDismissals = (campaignElement) => {
    const elements = getCampaignClickthroughAndDismissalElements(campaignElement);
    elements.off("click", sendClickthroughOrDismissal);
    elements.on("click", sendClickthroughOrDismissal);
};

const validateOnTemplateDisplayEndEvent = (event) => {
    if (!event.detail) {
        Evergage.log.warn("campaignStatsTracking.js", "No detail object found for onTemplateDisplayEndEvent", event);
        return false;
    }
    if (!event.detail.payload) {
        Evergage.log.warn("campaignStatsTracking.js", "No payload object found for onTemplateDisplayEndEvent", event);
        return false;
    }
    if (!event.detail.payload.campaign) {
        Evergage.log.warn("campaignStatsTracking.js", "No campaign found in payload object", event.detail);
        return false;
    }
    if (!event.detail.payload.experience) {
        Evergage.log.warn("campaignStatsTracking.js", "No experience found in payload object", event.detail);
        return false;
    }
    if (!event.detail.payload.userGroup) {
        Evergage.log.warn("campaignStatsTracking.js", "No user group found in payload object", event.detail);
        return false;
    }
    return true;
};

} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
        Evergage.sendException(e, "beaconExtension: Campaign Stats Tracking:campaignStatsTracking.js");
    }
};


try {
    Evergage.DisplayUtils = Evergage.DisplayUtils || (function () {
    var unbindByIds = {};

    function generateId() {
        var id = Math.random().toString(36).slice(2);
        while (unbindByIds[id]) {
            id = Math.random().toString(36).slice(2);
        }
        return id;
    }

    function getBindId(providedId, defaultId, useRandomId) {
        return providedId || (useRandomId ? generateId() : defaultId);
    }

    function buildBaseMethods(bindId, useRandomId) {
        return {
            pageElementLoaded: function (targetSelector, observerSelector) {
                observerSelector = typeof observerSelector === "string" ? observerSelector : "body";
                if (typeof targetSelector !== "string" || targetSelector === "" || typeof observerSelector !== "string" || observerSelector === "") {
                    throw new Error("[pageElementLoaded] Invalid arguments");
                }

                return new Promise(function (resolve) {
                    var targetElements = Evergage.cashDom(targetSelector);
                    if (targetElements.length > 0) {
                        resolve(targetElements[0]);
                    } else {
                        var observerNode = Evergage.cashDom(observerSelector)[0];
                        var observer = new MutationObserver(function (mutationList, observer) {
                            for (var mutationRecord of mutationList) {
                                if (mutationRecord.addedNodes && mutationRecord.addedNodes.length > 0) {
                                    for (var addedNode of mutationRecord.addedNodes) {
                                        var targetElement = Evergage.cashDom(addedNode).is(targetSelector)
                                            ? addedNode
                                            : Evergage.cashDom(addedNode).find(targetSelector).get(0);
                                        if (targetElement) {
                                            if (bindId) {
                                                bindingMethods.unbind(bindId);
                                            } else {
                                                observer.disconnect();
                                            }
                                            resolve(targetElement);
                                            return;
                                        }
                                    }
                                }
                            }
                        });
                        observer.observe(observerNode, {
                            childList: true,
                            subtree: true,
                        });
                    }

                    bindId = getBindId(bindId, "<pageElementLoaded>" + targetSelector, useRandomId);
                    unbindByIds[bindId] = function () {
                        observer && observer.disconnect();
                    };
                });
            },
            pageElementVisible: function (selector, percentage) {
                var threshold = percentage || 0;
                if (typeof selector !== "string" || selector === "" || typeof threshold !== "number" || threshold < 0 || threshold > 1) {
                    throw new Error("[pageElementVisible] Invalid arguments");
                }

                return new Promise(function (resolve) {
                    var target = Evergage.cashDom(selector);
                    var options = {
                        threshold: threshold,
                    };
                    var observer = new IntersectionObserver(callbackFn, options);

                    function callbackFn(entries, observer) {
                        for (var i = 0; i < entries.length; i++) {
                            if (entries[i].isIntersecting) {
                                if (bindId) {
                                    bindingMethods.unbind(bindId);
                                } else {
                                    observer.disconnect();
                                }
                                resolve(entries[i]);
                                break;
                            }
                        }
                    }

                    observer.observe(target[0]);
                    bindId = getBindId(bindId, "<pageElementVisible>" + selector, useRandomId);
                    unbindByIds[bindId] = function () {
                        observer.disconnect();
                    };
                });
            },
            pageExit: function (delay) {
                delay = delay || 0;
                if (typeof delay !== "number" || delay < 0) {
                    throw new Error("[pageExit] Invalid arguments");
                }

                return new Promise(function (resolve) {
                    var $target = Evergage.cashDom(document);
                    var events = "mousemove";
                    var timer;

                    function onmousemove(e) {
                        clearTimeout(timer);
                        if (e.pageY - window.pageYOffset <= 10) {
                            timer = delay > 0 ? setTimeout(callbackFn.bind(this, e), delay) : callbackFn.call(this, e);
                        }
                    }

                    function callbackFn(e) {
                        if (bindId) {
                            bindingMethods.unbind(bindId);
                        } else {
                            $target.off(events, onmousemove);
                        }
                        clearTimeout(timer);
                        resolve(e);
                    }

                    $target.on(events, onmousemove);

                    bindId = getBindId(bindId, "<pageExit>", useRandomId);
                    unbindByIds[bindId] = function () {
                        $target.off(events, onmousemove);
                    };
                });
            },
            pageInactive: function (ms) {
                if (typeof ms !== "number" || ms <= 0) {
                    throw new Error("[pageInactive] Invalid arguments");
                }

                function _pageInactive(ms, state) {
                    var promise = new Promise(function (resolve) {
                        var $target = Evergage.cashDom(document);
                        var resetEvents = "mousemove click scroll keyup keydown";
                        var idleTimer;

                        function callbackFn(e) {
                            e = e || new Event("pageInactive");
                            if (bindId && !state.isSubscribe) {
                                bindingMethods.unbind(bindId);
                            } else {
                                $target.off(resetEvents, resetTimer);
                            }
                            resolve(e);
                        }

                        function resetTimer(e) {
                            clearTimeout(idleTimer);
                            idleTimer = setTimeout(callbackFn.bind(this, e), ms);
                        }

                        resetTimer();

                        $target.on(resetEvents, resetTimer);
                    });

                    promise.subscribe = function subscribe(callback) {
                        delete promise.subscribe;
                        state.isSubscribe = true;
                        promise.then(function (event) {
                            event.disconnect = function () {
                                if (bindId) {
                                    bindingMethods.unbind(bindId);
                                } else {
                                    state.isDisconnected = true;
                                }
                            };
                            callback(event);
                            !state.isDisconnected && _pageInactive(ms, state).subscribe(callback);
                        });
                        return promise;
                    };

                    return promise;
                }

                var state = {
                    isDisconnected: false,
                    isSubscribe: false,
                };

                bindId = getBindId(bindId, "<pageInactive>", useRandomId);
                unbindByIds[bindId] = function () {
                    state.isDisconnected = true;
                };

                return _pageInactive(ms, state);
            },
            pageScroll: function (percentage) {
                if (typeof percentage !== "number" || percentage < 0 || percentage > 1) {
                    throw new Error("[pageScroll] Invalid arguments");
                }

                return new Promise(function (resolve) {
                    var $target = Evergage.cashDom(document);
                    var events = "scroll";

                    function callbackFn(e) {
                        resolve(e);
                        if (bindId) {
                            bindingMethods.unbind(bindId);
                        } else {
                            $target.off(events, onScroll);
                        }
                    }

                    function onScroll(e) {
                        var scrollPercentage = window.scrollY / (document.documentElement.scrollHeight - window.innerHeight);
                        if (scrollPercentage >= percentage) {
                            callbackFn.call(this, e);
                        }
                    }

                    $target.on(events, onScroll);

                    bindId = getBindId(bindId, "<pageScroll>", useRandomId);
                    unbindByIds[bindId] = function () {
                        $target.off(events, onScroll);
                    };
                });
            },
        };
    }

    function buildBindingMethods() {
        return {
            bind: function (id) {
                if (id && unbindByIds[id]) {
                    unbindByIds[id]();
                    delete unbindByIds[id];
                }
                return buildBaseMethods(id);
            },
            unbind: function (id) {
                if (!id || typeof id !== "string" || typeof unbindByIds[id] !== "function") return null;
                unbindByIds[id]();
                delete unbindByIds[id];
            },
            getBindings: function () {
                return unbindByIds;
            },
            clearBindings: function () {
                for (var id in unbindByIds) {
                    if (unbindByIds.hasOwnProperty(id)) {
                        unbindByIds[id]();
                        delete unbindByIds[id];
                    }
                }
            }
        };
    }

    var baseMethods = buildBaseMethods(null, true);
    var bindingMethods = buildBindingMethods();
    return Object.assign(baseMethods, bindingMethods);
})();

} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
        Evergage.sendException(e, "beaconExtension: Display Utilities:displayUtils.js");
    }
};


try {
    /**
 *  Personalization Flicker Defense
 */

function hideSections() {
    let sectionsHaveEverBeenHidden = false;

    let globalContentZonesSelectors = ((Evergage.getState().config.global || {}).contentZones || []).map(cz => {if (cz.selector) return cz.selector});
    let pageTypeContentZonesSelectors = (Evergage.getState().config.pageTypes || []).reduce(function(acc, cur) {
        if (Array.isArray(cur.contentZones)) {
            cur.contentZones.forEach(function(cz) {
                if (cz.selector) {
                    acc.push(cz.selector);
                }
            })
        }
        return acc;
    }, []);

    let selectors = [ ...globalContentZonesSelectors, ...pageTypeContentZonesSelectors ];
    if (sectionsHaveEverBeenHidden) {
        return;
    }
    let personalizedSectionsString = "";
    if (selectors.length === 0) {
        Evergage.log.debug("Evergage: Issue with malformed request in hideSections.");
        return;
    }
    for (let i = 0; i < selectors.length - 1; i++) {
        if (typeof selectors[i] === "string") {
            try {
                if (selectors[i] === "body" || selectors[i] === "html") {
                    continue;
                }
                document.querySelector(selectors[i]);
                if (personalizedSectionsString !== "") {
                    personalizedSectionsString += ", ";
                }
                personalizedSectionsString += selectors[i];
            } catch (exception) {
                Evergage.sendException(exception, "hideSectionsInvalidCSSSelector");
            }
        }
    }
    if (!personalizedSectionsString) {
        return;
    }
    personalizedSectionsString += " { visibility: hidden !important; }";

    let head = document.head || document.getElementsByTagName("head")[0];
    let style = document.createElement("style");
    style.type = "text/css";
    style.setAttribute("class", "evergagePersonalizationSections");
    if (style.styleSheet) {
        style.styleSheet.cssText = personalizedSectionsString;
    } else {
        style.appendChild(document.createTextNode(personalizedSectionsString));
    }

    let maxTimeToWaitForPersonalization = 2000;
    clearTimeout(window.evergageReshowPersonalizedSectionsTimeout);
    window.evergageReshowPersonalizedSectionsTimeout = setTimeout(function () {
        reshowPersonalizedSectionsNow();
    }, maxTimeToWaitForPersonalization);

    head.appendChild(style);
    sectionsHaveEverBeenHidden = true;
}

function reshowPersonalizedSections() {
    try {
        if (typeof window.requestAnimationFrame === "function") {
            Evergage.log.info("Evergage: Scheduling for next animation frame redisplay of sections of the page marked for personalization.");
            window.requestAnimationFrame(reshowPersonalizedSectionsNow);
        } else {
            reshowPersonalizedSectionsNow();
        }
    } catch (exception) {
        Evergage.sendException(exception, "reshowPersonalizedSections");
    }
}

const personalizationSectionsSelector = "head > style.evergagePersonalizationSections";

function reshowPersonalizedSectionsNow() {
    try {
        Evergage.cashDom(personalizationSectionsSelector).remove();
        Evergage.log.info("Evergage: Redisplaying sections of the page marked for personalization.");
    } catch (exception) {
        Evergage.sendException(exception, "reshowPersonalizedSectionsNow");
    }
}

let hasBeenHidden = false;

document.addEventListener(Evergage.CustomEvents.OnPageMatchStatusUpdated, domEvent => {
    if (!hasBeenHidden) {
        hideSections();
        if (Evergage.cashDom(personalizationSectionsSelector).length > 0) {
            hasBeenHidden = true;
        }
    }
});

document.addEventListener(Evergage.CustomEvents.OnEventResponse, domEvent => {
    reshowPersonalizedSections();
});

} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
        Evergage.sendException(e, "beaconExtension: Flicker Defender:flickerDefender.js");
    }
};


try {
    !function(e,t){for(var n in t)e[n]=t[n]}(window,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=8)}([function(e,t,n){"use strict";n.r(t),n.d(t,"extend",function(){return l}),n.d(t,"toString",function(){return c}),n.d(t,"isFunction",function(){return s}),n.d(t,"isArray",function(){return u}),n.d(t,"indexOf",function(){return p}),n.d(t,"escapeExpression",function(){return f}),n.d(t,"isEmpty",function(){return d}),n.d(t,"createFrame",function(){return h}),n.d(t,"blockParams",function(){return m}),n.d(t,"appendContextPath",function(){return g});const r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;","=":"&#x3D;"},o=/[&<>"'`=]/g,a=/[&<>"'`=]/;function i(e){return r[e]}function l(e){for(let t=1;t<arguments.length;t++)for(let n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e}let c=Object.prototype.toString,s=function(e){return"function"==typeof e};s(/x/)&&(s=function(e){return"function"==typeof e&&"[object Function]"===c.call(e)});const u=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===c.call(e)};function p(e,t){for(let n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function f(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return a.test(e)?e.replace(o,i):e}function d(e){return!e&&0!==e||!(!u(e)||0!==e.length)}function h(e){let t=l({},e);return t._parent=e,t}function m(e,t){return e.path=t,e}function g(e,t){return(e?e+".":"")+t}},function(e,t,n){"use strict";const r=["description","fileName","lineNumber","endLineNumber","message","name","number","stack"];function o(e,t){let n,a,i,l,c=t&&t.loc;c&&(n=c.start.line,a=c.end.line,i=c.start.column,l=c.end.column,e+=" - "+n+":"+i);let s=Error.prototype.constructor.call(this,e);for(let e=0;e<r.length;e++)this[r[e]]=s[r[e]];Error.captureStackTrace&&Error.captureStackTrace(this,o);try{c&&(this.lineNumber=n,this.endLineNumber=a,Object.defineProperty?(Object.defineProperty(this,"column",{value:i,enumerable:!0}),Object.defineProperty(this,"endColumn",{value:l,enumerable:!0})):(this.column=i,this.endColumn=l))}catch(e){}}o.prototype=new Error,t.a=o},function(e,t,n){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(10),a=n(3),i=r(n(4)),l=new Map,c=new Map,s=new Set,u=function(){return document.getElementsByTagName("html").length>0&&null!=document.getElementsByTagName("html")[0].getAttribute(i.VE_LOADING_ATTRIBUTE)||null!=document.getElementById(i.VE_ACTIVE_ELEMENT_ID)||"true"===localStorage.getItem(i.VE_INDICATOR_FLAG)||document.location.href.includes(i.TEST_TEMPLATE_PARAMETER)},p=function(e){return l.get(e)},f=function(e,t){return[e,t.campaign,t.experience].join(":")};t.executeBundles=function(e){e&&e.forEach(function(e){try{Function("TemplateService",e.bundle)({registerTemplate:t.registerTemplate})}catch(e){a.dispatchError(e)}})},t.registerTemplate=function(e){var t=new o.Template(e);l.set(e.name,t)},t.resetTemplate=function(e,t){var n=f(e,t),r=c.get(n);if(r)try{r()}catch(e){a.dispatchError(e)}c.delete(n)},t.renderTemplate=function(e,t){if(l.has(e)){var n=p(e).render(t);c.set(f(e,t),n)}},t.handleCampaignResponses=function(e){u()||e.filter(function(e){return"ng"===e.type}).filter(function(e){return!h(e)}).forEach(function(e){switch(e.userGroup){case"Default":d(e);break;case"Control":t.executeControl(e)}})};var d=function(e){e.templateNames.forEach(function(n){t.renderTemplate(n,e.payload)})};t.executeControl=function(e){e.templateNames.forEach(function(t){var n=p(t),r=e.payload;if(n.control)try{var o=n.control(r);window.Promise&&window.Promise.resolve(o)===o?o.then(function(){a.dispatchTemplateDisplay(r)}):a.dispatchTemplateDisplay(r)}catch(e){a.dispatchError(e)}})};var h=function(e){return e.payload.contentZone&&s.has(e.payload.contentZone)};t.restrictContentZone=function(e){e&&s.add(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getQueryParam=function(e){var t=location.search;e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))},t.dispatchTemplateDisplay=function(e){document.dispatchEvent(new CustomEvent(window.Evergage.CustomEvents.OnTemplateDisplayEnd,{detail:{payload:e}}))},t.dispatchError=function(e){document.dispatchEvent(new CustomEvent(window.Evergage.CustomEvents.OnException,{detail:{error:new Error(e),context:"Handlebars Template Gear"}}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TEST_TEMPLATE_STORAGE_KEY="testTemplate",t.TEST_TEMPLATE_PARAMETER="evergageTestTemplate",t.VE_LOADING_ATTRIBUTE="evergagevisualeditorloading",t.VE_INDICATOR_FLAG="evgVE",t.VE_ACTIVE_ELEMENT_ID="evg_ui-visual-editor"},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){var r=n(0),o=n(1);t.a=function(t){t.registerHelper("each",function(t,n){if(!n)throw new o.a("Must pass iterator to #each");let a,i,l=n.fn,c=n.inverse,s=0,u="";function p(e,n,o){a&&(a.key=e,a.index=n,a.first=0===n,a.last=!!o,i&&(a.contextPath=i+e)),u+=l(t[e],{data:a,blockParams:Object(r.blockParams)([t[e],e],[i+e,null])})}if(n.data&&n.ids&&(i=Object(r.appendContextPath)(n.data.contextPath,n.ids[0])+"."),Object(r.isFunction)(t)&&(t=t.call(this)),n.data&&(a=Object(r.createFrame)(n.data)),t&&"object"==typeof t)if(Object(r.isArray)(t))for(let e=t.length;s<e;s++)s in t&&p(s,s,s===t.length-1);else if(e.Symbol&&t[e.Symbol.iterator]){const n=[],r=t[e.Symbol.iterator]();for(let e=r.next();!e.done;e=r.next())n.push(e.value);for(let e=(t=n).length;s<e;s++)p(s,s,s===t.length-1)}else{let e;Object.keys(t).forEach(t=>{void 0!==e&&p(e,s-1),e=t,s++}),void 0!==e&&p(e,s-1,!0)}return 0===s&&(u=c(this)),u})}}).call(this,n(5))},function(e,t,n){"use strict";(function(e){t.a=function(t){let n=void 0!==e?e:window,r=n.Handlebars;t.noConflict=function(){return n.Handlebars===t&&(n.Handlebars=r),t}}}).call(this,n(5))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),o=n(11),a=n(2);function i(){/complete|interactive|loaded/.test(document.readyState)?(r.renderTestTemplate(),o.initPreview()):document.addEventListener("DOMContentLoaded",function(){r.renderTestTemplate(),o.initPreview()})}document.addEventListener(window.Evergage.CustomEvents.OnEventResponse,function(e){a.executeBundles(e.detail.response.compiledCampaignTemplates),a.handleCampaignResponses(e.detail.response.campaignResponses)}),t.render=i,i()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=n(3),a=n(4);t.renderTestTemplate=function(){if("true"==o.getQueryParam(a.TEST_TEMPLATE_PARAMETER)){var e=i();addEventListener("storage",function(t){t.key==a.TEST_TEMPLATE_STORAGE_KEY&&(e&&r.resetTemplate(e.templateName,e.templateConfig),e=i())})}};var i=function(){var e=localStorage.getItem(a.TEST_TEMPLATE_STORAGE_KEY);if(e)try{var t=JSON.parse(e);return r.executeBundles(t.templates),r.renderTemplate(t.templateName,t.templateConfig),r.restrictContentZone(t.templateConfig.contentZone),t}catch(e){}}},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(12)),a=n(3),i=function(){function e(e){var t=this;if(this.getContentZoneFromMatchedConfig=function(e){var t=window.Evergage.getState().result.matchedConfig;return e.contentZone&&t&&t.contentZones&&0!==t.contentZones.length&&t.contentZones.find(function(t){return t.name===e.contentZone})||null},this.applyRender=function(e){var n=t.getContentZoneFromMatchedConfig(e);n&&t.executeInsertionForTarget(n,e)},this.replaceContentAtTarget=function(e,t){t.innerHTML=e},this.name=e.name,this.apply=e.apply,this.reset=e.reset,this.control=e.control,e.handlebars)try{this.generateHtml=o.default.template(e.handlebars),o.default.partials[e.name]=o.default.template(e.handlebars)}catch(e){a.dispatchError(e)}else this.generateHtml=function(){}}return e.prototype.render=function(e){try{var t=this.apply(e,this.generateHtml,this.applyRender);return window.Promise&&window.Promise.resolve(t)===t?t.then(function(){a.dispatchTemplateDisplay(e)}):a.dispatchTemplateDisplay(e),this.reset.bind(this,e,this.generateHtml)}catch(e){a.dispatchError(e)}},e.prototype.executeInsertionForTarget=function(e,t){if(this.generateHtml){var n=e.selector;try{var r=document.querySelector(n);if(!r){var o='Could not render template. Content zone "'+e.name+'" defined but the selector "'+n+'" not found on the page.';return void a.dispatchError(o)}var i=this.generateHtml(t);if(!i)return;this.replaceContentAtTarget(i,r)}catch(e){a.dispatchError(e)}}},e}();t.Template=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),o=n(2);t.initPreview=function(){window.Evergage.Render={render:function(e,t,n){var a=JSON.stringify({templateName:e,templateConfig:t,templates:n});window.localStorage.setItem(r.TEST_TEMPLATE_STORAGE_KEY,a),o.resetTemplate(e,t),o.executeBundles(n),o.renderTemplate(e,t)},reset:o.resetTemplate},window.Evergage.getContentZoneSelector=function(e){var t=(window.Evergage.getState().result.matchedConfig||{}).contentZones;if(!t)return null;var n=t.find(function(t){return t.name===e});return n&&n.selector?n.selector:null}}},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"VERSION",function(){return b}),n.d(r,"COMPILER_REVISION",function(){return w}),n.d(r,"LAST_COMPATIBLE_COMPILER_REVISION",function(){return y}),n.d(r,"REVISION_CHANGES",function(){return T}),n.d(r,"HandlebarsEnvironment",function(){return _}),n.d(r,"log",function(){return O}),n.d(r,"createFrame",function(){return a.createFrame}),n.d(r,"logger",function(){return E});var o={};n.r(o),n.d(o,"checkRevision",function(){return j}),n.d(o,"template",function(){return M}),n.d(o,"wrapProgram",function(){return S}),n.d(o,"resolvePartial",function(){return C}),n.d(o,"invokePartial",function(){return k}),n.d(o,"noop",function(){return A});var a=n(0),i=n(1),l=function(e){e.registerHelper("blockHelperMissing",function(t,n){let r=n.inverse,o=n.fn;if(!0===t)return o(this);if(!1===t||null==t)return r(this);if(Object(a.isArray)(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):r(this);if(n.data&&n.ids){let e=Object(a.createFrame)(n.data);e.contextPath=Object(a.appendContextPath)(n.data.contextPath,n.name),n={data:e}}return o(t,n)})},c=n(6),s=function(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new i.a('Missing helper: "'+arguments[arguments.length-1].name+'"')})},u=function(e){e.registerHelper("if",function(e,t){if(2!=arguments.length)throw new i.a("#if requires exactly one argument");return Object(a.isFunction)(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||Object(a.isEmpty)(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){if(2!=arguments.length)throw new i.a("#unless requires exactly one argument");return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})})},p=function(e){e.registerHelper("log",function(){let t=[void 0],n=arguments[arguments.length-1];for(let e=0;e<arguments.length-1;e++)t.push(arguments[e]);let r=1;null!=n.hash.level?r=n.hash.level:n.data&&null!=n.data.level&&(r=n.data.level),t[0]=r,e.log(...t)})};const f=/^(constructor|__defineGetter__|__defineSetter__|__lookupGetter__|__proto__)$/;var d=function(e){e.registerHelper("lookup",function(e,t){return e?!f.test(String(t))||Object.prototype.propertyIsEnumerable.call(e,t)?e[t]:void 0:e})},h=function(e){e.registerHelper("with",function(e,t){if(2!=arguments.length)throw new i.a("#with requires exactly one argument");Object(a.isFunction)(e)&&(e=e.call(this));let n=t.fn;if(Object(a.isEmpty)(e))return t.inverse(this);{let r=t.data;return t.data&&t.ids&&((r=Object(a.createFrame)(t.data)).contextPath=Object(a.appendContextPath)(t.data.contextPath,t.ids[0])),n(e,{data:r,blockParams:Object(a.blockParams)([e],[r&&r.contextPath])})}})};function m(e,t,n){e.helpers[t]&&(e.hooks[t]=e.helpers[t],n||delete e.helpers[t])}var g=function(e){e.registerDecorator("inline",function(e,t,n,r){let o=e;return t.partials||(t.partials={},o=function(r,o){let i=n.partials;n.partials=Object(a.extend)({},i,t.partials);let l=e(r,o);return n.partials=i,l}),t.partials[r.args[0]]=r.fn,o})};let v={methodMap:["debug","info","warn","error"],level:"info",lookupLevel:function(e){if("string"==typeof e){let t=Object(a.indexOf)(v.methodMap,e.toLowerCase());e=t>=0?t:parseInt(e,10)}return e},log:function(e,...t){if(e=v.lookupLevel(e),"undefined"!=typeof console&&v.lookupLevel(v.level)<=e){let n=v.methodMap[e];console[n]||(n="log"),console[n](...t)}}};var E=v;const b="4.5.3",w=8,y=7,T={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1",7:">= 4.0.0 <4.3.0",8:">= 4.3.0"};function _(e,t,n){var r;this.helpers=e||{},this.partials=t||{},this.decorators=n||{},l(r=this),Object(c.a)(r),s(r),u(r),p(r),d(r),h(r),function(e){g(e)}(this)}_.prototype={constructor:_,logger:E,log:E.log,registerHelper:function(e,t){if("[object Object]"===a.toString.call(e)){if(t)throw new i.a("Arg not supported with multiple helpers");Object(a.extend)(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===a.toString.call(e))Object(a.extend)(this.partials,e);else{if(void 0===t)throw new i.a(`Attempting to register a partial called "${e}" as undefined`);this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]},registerDecorator:function(e,t){if("[object Object]"===a.toString.call(e)){if(t)throw new i.a("Arg not supported with multiple decorators");Object(a.extend)(this.decorators,e)}else this.decorators[e]=t},unregisterDecorator:function(e){delete this.decorators[e]}};let O=E.log;function P(e){this.string=e}P.prototype.toString=P.prototype.toHTML=function(){return""+this.string};var x=P;function j(e){const t=e&&e[0]||1;if(!(t>=y&&t<=w)){if(t<y){const e=T[w],n=T[t];throw new i.a("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+e+") or downgrade your runtime to an older version ("+n+").")}throw new i.a("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}}function M(e,t){if(!t)throw new i.a("No environment passed to template");if(!e||!e.main)throw new i.a("Unknown template object: "+typeof e);e.main.decorator=e.main_d,t.VM.checkRevision(e.compiler);const n=e.compiler&&7===e.compiler[0];let r={strict:function(e,t,n){if(!(e&&t in e))throw new i.a('"'+t+'" not defined in '+e,{loc:n});return e[t]},lookup:function(e,t){const n=e.length;for(let r=0;r<n;r++)if(e[r]&&null!=e[r][t])return e[r][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:a.escapeExpression,invokePartial:function(n,r,o){o.hash&&(r=a.extend({},r,o.hash),o.ids&&(o.ids[0]=!0)),n=t.VM.resolvePartial.call(this,n,r,o);let l=a.extend({},o,{hooks:this.hooks}),c=t.VM.invokePartial.call(this,n,r,l);if(null==c&&t.compile&&(o.partials[o.name]=t.compile(n,e.compilerOptions,t),c=o.partials[o.name](r,l)),null!=c){if(o.indent){let e=c.split("\n");for(let t=0,n=e.length;t<n&&(e[t]||t+1!==n);t++)e[t]=o.indent+e[t];c=e.join("\n")}return c}throw new i.a("The partial "+o.name+" could not be compiled when running in runtime-only mode")},fn:function(t){let n=e[t];return n.decorator=e[t+"_d"],n},programs:[],program:function(e,t,n,r,o){let a=this.programs[e],i=this.fn(e);return t||o||r||n?a=S(this,e,i,t,n,r,o):a||(a=this.programs[e]=S(this,e,i)),a},data:function(e,t){for(;e&&t--;)e=e._parent;return e},nullContext:Object.seal({}),noop:t.VM.noop,compilerInfo:e.compiler};function o(t,n={}){let i=n.data;o._setup(n),!n.partial&&e.useData&&(i=function(e,t){t&&"root"in t||((t=t?Object(a.createFrame)(t):{}).root=e);return t}(t,i));let l,c=e.useBlockParams?[]:void 0;function s(t){return""+e.main(r,t,r.helpers,r.partials,i,c,l)}return e.useDepths&&(l=n.depths?t!=n.depths[0]?[t].concat(n.depths):n.depths:[t]),(s=I(e.main,s,r,n.depths||[],i,c))(t,n)}return o.isTop=!0,o._setup=function(o){if(o.partial)r.helpers=o.helpers,r.partials=o.partials,r.decorators=o.decorators,r.hooks=o.hooks;else{r.helpers=a.extend({},t.helpers,o.helpers),e.usePartial&&(r.partials=a.extend({},t.partials,o.partials)),(e.usePartial||e.useDecorators)&&(r.decorators=a.extend({},t.decorators,o.decorators)),r.hooks={};let i=o.allowCallsToHelperMissing||n;m(r,"helperMissing",i),m(r,"blockHelperMissing",i)}},o._child=function(t,n,o,a){if(e.useBlockParams&&!o)throw new i.a("must pass block params");if(e.useDepths&&!a)throw new i.a("must pass parent depths");return S(r,t,e[t],n,0,o,a)},o}function S(e,t,n,r,o,a,i){function l(t,o={}){let l=i;return!i||t==i[0]||t===e.nullContext&&null===i[0]||(l=[t].concat(i)),n(e,t,e.helpers,e.partials,o.data||r,a&&[o.blockParams].concat(a),l)}return(l=I(n,l,e,i,r,a)).program=t,l.depth=i?i.length:0,l.blockParams=o||0,l}function C(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e="@partial-block"===n.name?n.data["partial-block"]:n.partials[n.name],e}function k(e,t,n){const r=n.data&&n.data["partial-block"];let o;if(n.partial=!0,n.ids&&(n.data.contextPath=n.ids[0]||n.data.contextPath),n.fn&&n.fn!==A){n.data=Object(a.createFrame)(n.data);let e=n.fn;o=n.data["partial-block"]=function(t,n={}){return n.data=Object(a.createFrame)(n.data),n.data["partial-block"]=r,e(t,n)},e.partials&&(n.partials=a.extend({},n.partials,e.partials))}if(void 0===e&&o&&(e=o),void 0===e)throw new i.a("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)}function A(){return""}function I(e,t,n,r,o,i){if(e.decorator){let l={};t=e.decorator(t,l,n,r&&r[0],o,i,r),a.extend(t,l)}return t}var H=n(7);function L(){let e=new _;return a.extend(e,r),e.SafeString=x,e.Exception=i.a,e.Utils=a,e.escapeExpression=a.escapeExpression,e.VM=o,e.template=function(t){return M(t,e)},e}let R=L();R.create=L,Object(H.a)(R),R.default=R;t.default=R}]));
} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
        Evergage.sendException(e, "beaconExtension: Handlebars Templates:index.js");
    }
};


try {
    // syncs with @frontend/packages/ui-chrome-extension/src/constants.ts#CUSTOM_EVENT.MESSAGE_FROM_INTERACTION_STUDIO_TOOLS_GEAR
var VE_CUSTOM_EVENT_NAME = 'msg_from_interaction_studio_tools_gear';
// syncs with @frontend/packages/ui-chrome-extension/src/constants.ts#EVENT_TYPE.MESSAGE_FROM_INTERACTION_STUDIO_TOOLS_GEAR
var TO_LAUNCHER_MESSAGE_TYPE = 'nxve_messageFromInteractionStudioToolsGear';

var TO_LAUNCHER_PAYLOAD_TYPE = 'beaconSDK_domEvent';

function sendMessageToEvergageLauncher(message) {
    try {
        document.dispatchEvent(
            new CustomEvent(VE_CUSTOM_EVENT_NAME, {
                detail: JSON.stringify(message),
            })
        );
    } catch (e) {
        console.error(e);
    }
}

var eventLinkId = null;

if (Evergage !== null) {
    document.addEventListener(Evergage.CustomEvents.OnInit, function (
        domEvent
    ) {
        sendMessageToEvergageLauncher({
            type: TO_LAUNCHER_MESSAGE_TYPE,
            payload: {
                type: TO_LAUNCHER_PAYLOAD_TYPE,
                payload: {
                    name: Evergage.CustomEvents.OnInit,
                    detail: domEvent.detail,
                },
            },
        });
    });

    document.addEventListener(Evergage.CustomEvents.OnEventSend, function (
        domEvent
    ) {
        eventLinkId = Math.random().toString().slice(2);

        domEvent.detail.actionEvent._toolsEventLinkId = eventLinkId;
        domEvent.detail.actionEvent.debug = Object.assign(
            domEvent.detail.actionEvent.debug
                ? domEvent.detail.actionEvent.debug
                : {},
            { explanations: true }
        );

        sendMessageToEvergageLauncher({
            type: TO_LAUNCHER_MESSAGE_TYPE,
            payload: {
                type: TO_LAUNCHER_PAYLOAD_TYPE,
                payload: {
                    name: Evergage.CustomEvents.OnEventSend,
                    detail: domEvent.detail,
                },
            },
        });
    });

    document.addEventListener(Evergage.CustomEvents.OnEventResponse, function (
        domEvent
    ) {
        if (domEvent.detail) {
            const currentPage = Evergage.getCurrentPage();
            const sitemapConfig = Evergage.getState().config;
            const matchedPageConfig =
                Evergage.getState().result &&
                Evergage.getState().result.matchedConfig;

            eventLinkId = null;

            sendMessageToEvergageLauncher({
                type: TO_LAUNCHER_MESSAGE_TYPE,
                payload: {
                    type: TO_LAUNCHER_PAYLOAD_TYPE,
                    payload: {
                        name: Evergage.CustomEvents.OnEventResponse,
                        detail: {
                            response: domEvent.detail.response,
                            currentPage: currentPage,
                            sitemapConfig: sitemapConfig,
                            matchedPageConfig: matchedPageConfig,
                        },
                    },
                },
            });
        }
    });
}

} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
        Evergage.sendException(e, "beaconExtension: Interaction Studio Tools:interactionStudioTools.js");
    }
};


try {
    (function() {
    function injectVisualEditorLaunchScript(account) {
        try {
            var scriptTag = document.createElement('script');
            var scriptUrl = 'https://cdn.evergage.com/visual-editor/launch.js';
            if (Evergage.getConfig().trackerUrl) {
                scriptUrl = Evergage.getConfig().trackerUrl + '/visual-editor/launch.js'
            }
            scriptTag.setAttribute('id', 'evergageVisualEditorLaunchScript');
            scriptTag.src = scriptUrl;
            if (document.getElementById('evergageVisualEditorLaunchScript') == null) {
                document.head.appendChild(scriptTag);
            } else {
                Evergage.log.info('Launch script is already here.');
            }
        } catch (err) {
            Evergage.log.info('Failed to fetch the siteEditorFramein page services: ' + err);
        }
    }

    function getUrlBoolean(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? null : results[1] === 'true';
    }

    var veParam = getUrlBoolean('evergageEditor');
    var testTemplateParam = getUrlBoolean('evergageTestTemplate');

    var isVESiteEditorFrame = window.frameElement && window.frameElement.id === 'siteEditorFrame';
    var enabledInStorage = function() {
        return window.localStorage['evgVE'] === 'true';
    };

    // honor and set local storage based off queryParam
    if (veParam !== null) {
        window.localStorage.setItem('evgVE', veParam);
    }

    // trigger off of localStorage only
    // chrome extension reads/sets localStorage more easily than modifying the currentTab URL
    if ((!enabledInStorage() || !(enabledInStorage() && !testTemplateParam)) && !isVESiteEditorFrame) {
        return;
    }

    if (window.top === window.self || isVESiteEditorFrame) {
        document.addEventListener(Evergage.CustomEvents.OnInit, (event) => {
            const beaconConfig = event.detail.beaconConfig;
            injectVisualEditorLaunchScript(beaconConfig.account);
            event.preventDefault();
        }, { once: true });
    }
})();

} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
        Evergage.sendException(e, "beaconExtension: Visual Editor:visualEditor.js");
    }
};


try {
var evgr = Evergage.resolvers;
Evergage.init({
  cookieDomain: "enfamil.com"
}).then((state) => {
  const config = {
      global: {
        locale: Evergage.resolvers.fromMeta("og:locale", (content) => content !== undefined ? content.substring(0, 3) + content.substring(3).toUpperCase() : "en_US"),
        contentZones: [
          {name: "global_popup"},
          {name: "global_nav_bar_products",             selector: ".personalization-featured-product-nav div.featured-promo"},
          {name: "global_nav_bar_articles",             selector: ".personalization-featured-article-nav  > div.related-articles"},
          {name: "global_formula_finder",               selector: ".chatbot"},
          {name: "global_nav_bar_enrollment_link",      selector: ".account-nav-main > ul > li:first-child"},
          {name: "global_nav_bar_enrollment_menu_link", selector: "nav > ul > li:nth-child(4) > ul > li:nth-child(2) > section > div > div > div > div > div > div > div > div:nth-child(1) > div:nth-child(2)"},          
          // {name: "global_nav_bar_enrollment_menu_link", selector: "nav > ul > li:nth-child(4) > ul > li:nth-child(2) > section > div > div > div > div > div > div > div > div:nth-child(1) > div:nth-child(2) > a"},
        ],
        onActionEvent: function(event) {
          // Get Query String params
          const urlParams = new URLSearchParams(window.location.search);
          if (event.user ) {            
            event.user.attributes = event.user.attributes ? event.user.attributes : {};
            
            // Capture browser language
            event.user.attributes.browserLanguage = navigator.language;

            // Save last received query string parameter in attributes
            if (urlParams.has("page")) {
              event.user.attributes.lastPageParameter = urlParams.get("page");              
            }
            if (urlParams.has("gclid")) {
              event.user.attributes.lastAdCampaignGclid = urlParams.get("gclid");              
            }
            if (urlParams.has("utm_campaign")) {
              event.user.attributes.lastAdCampaignUtmCampaign = urlParams.get("utm_campaign");              
            }
            if (urlParams.has("utm_content")) {
              event.user.attributes.lastAdCampaignUtmContent = urlParams.get("utm_content");              
            }
            if (urlParams.has("utm_source")) {
              event.user.attributes.lastAdCampaignUtmSource = urlParams.get("utm_source");              
            }
            if (urlParams.has("utm_term")) {
              event.user.attributes.lastAdCampaignUtmTerm = urlParams.get("utm_term");              
            }

            // In the enrollment form we capture the dob of the baby and set it into a cookie.
            // Here we recalculate the baby stage and the baby age in months from that cookie in order 
            // to keep it current as time passes
            const evgDOB = getCookie("evg_dob");
            if (evgDOB) {
              event.user.attributes.childDueDate = Date.parse(evgDOB);
              if (Date.parse(evgDOB) < new Date()) {
                event.user.attributes.childStage = getBabyStage(Date.parse(evgDOB));
                event.user.attributes.childMonth = getDiffMonths(Date.parse(evgDOB));
                event.user.attributes.childWeek = getDiffWeeks(Date.parse(evgDOB));
                event.user.attributes.childPrenatalMonth = -1;
                event.user.attributes.childPrenatalWeek = -1;
              } else {
                event.user.attributes.childStage = -1;
                event.user.attributes.childMonth = -1;
                event.user.attributes.childWeek = -1;
                event.user.attributes.childPrenatalMonth = getDiffMonths(Date.parse(evgDOB));
                event.user.attributes.childPrenatalWeek = getDiffWeeks(Date.parse(evgDOB));
              }
            }
          }
          
          // console.log("[EVG] event", event);
          return event;
        },
      },
      pageTypeDefault: {
        name: "default"
      },   
      pageTypes: [
        {
          name: "error_page",
          action: "Error Page",
          isMatch: () => Evergage.cashDom(".general-error-page").length > 0,
        },
        // Home
        {
          name: "home",
          action: "Home",
          isMatch: () => {
            if (!/^https?:\/\/[^\/]*(\/)?(en|es)?(\/?\?{0}|\/?\?{1}.*)$/i.test(window.location.href)) {
              return false;
            } else {
              // Here we only use this because we need to wait until dataLayer is there. This is a SPA where the page can start loading before getting the dataLayer in place
              return isMatchDataLayer("home");
            } 
          },
          onActionEvent: (actionEvent) => setUserAttributesFromDataLayer(actionEvent, "home"),
          contentZones: [
            {name: "home_hero_banner_top", selector: ".personalization-shortform-top"},
            {name: "home_hero_banner_bottom", selector: ".personalization-shortform-bottom"},
            {name: "home_rtb_module", selector: ".guarantees-promo .guarantees-promo-heading"},
            {name: "home_featured_products", selector: ".product-list__products"},
            {name: "home_featured_articles", selector: ".personalisation-articles"}
          ],
          listeners: [
            Evergage.listener("submit", ".register-form", () => {
              const firstName = Evergage.cashDom("#registerGivenNameField").val();
              const evgDOB = Evergage.cashDom("#childregisterChildBirthDateField").val();
              
              if (evgDOB) {
                setCookie("evg_dob", evgDOB, 365);
                Evergage.sendEvent({
                  action: "Enrollment EFB - Step 1 Complete", user: {
                    attributes: {
                      firstName: firstName,
                      enrolmentProgramName: "EFB",
                      childDueDate: Date.parse(evgDOB)
                    }
                  }
                });
              }
            }),
          ]
        },
        // Profile - My Baby
        {
          name: "profile",
          action: "Profile View",
          isMatch: () => /\/account\/profile/i.test(window.location.href),
          listeners: [
            Evergage.listener("click", "li[data-key=\"1\"] > button", (button) => {
              Evergage.DisplayUtils.pageElementLoaded(".form__button.register-form__button").then(() => {
                setTimeout(() => { 
                  Evergage.cashDom('.register-form').each((idx) => {
                    Evergage.cashDom('.register-form')[idx].addEventListener('submit', formSubmit => {
                      const thisForm = Evergage.cashDom(formSubmit.target)[0];
                      let childPremature = Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildPrematureBirthFlagField`]).is(":checked");

                      let evgChildFeedingMethod = "";
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingMethodField_1`]).is(":checked")) {
                        evgChildFeedingMethod = `Breast milk only`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingMethodField_2`]).is(":checked")) {
                        evgChildFeedingMethod = `Formula only`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingMethodField_3`]).is(":checked")) {
                        evgChildFeedingMethod = `Breast milk and Formula`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingMethodField_4`]).is(":checked")) {
                        evgChildFeedingMethod = `Not sure`;
                      }

                      let evgFeedingIssue = "";
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingIssueField_GasAndFussiness`]).is(":checked")) {
                        evgFeedingIssue += `Gas,Fussiness,Gas And Fussiness,`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingIssueField_CryingOrColic`]).is(":checked")) {
                        evgFeedingIssue += `Crying,Colic,Crying Or Colic,`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingIssueField_LactoseIntolerance`]).is(":checked")) {
                        evgFeedingIssue += `Lactose Intolerance,`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingIssueField_OccasionConstipation`]).is(":checked")) {
                        evgFeedingIssue += `Occasion Constipation,`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingIssueField_LactoseSensitivity`]).is(":checked")) {
                        evgFeedingIssue += `Lactose Sensitivity,`;
                      }
                      if (Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildListFeedingIssueField_CowsMilkAllergies`]).is(":checked")) {
                        evgFeedingIssue += `Cow's Milk Allergy,`;
                      }
                      const evgDOB = Evergage.cashDom(thisForm.elements[`child${idx+1}registerChildBirthDateField`]).val();
                      setCookie("evg_dob", evgDOB, 365);
                      console.log(`[EVG] Submit Baby ${idx+1} DOB`, evgDOB);
                      console.log(`[EVG] Submit Baby ${idx+1} Issues`, evgFeedingIssue);
                      console.log(`[EVG] Submit Baby ${idx+1} Premature`, childPremature);
                      Evergage.sendEvent({
                        action: "Update Profile", user: {
                          attributes: {
                            childFeedingMethod: evgChildFeedingMethod,
                            declaredFeedingIssue: evgFeedingIssue,
                            childDueDate: Date.parse(evgDOB),
                            childPremature: childPremature
                          }
                        } 
                      });
                    });
                  });
                 }, 5000);
              });
            }),
          ]
        },
        // Enrollment EFB Thank You
        {
          name: "enrollment_efb_thank_you",
          action: "Enrollment EFB - Thank You Page View",
          isMatch: () => /\/baby-formula-coupons-samples\/thank-you/i.test(window.location.href),
          //isMatch: () => /\/enrollment\/thank-you/i.test(window.location.href),
          contentZones: [
            {name: "efb_featured_articles", selector: ".related-articles-wrapper"},
          ],
        },
        // Enrollment EFB 1
        {
          name: "enrollment_efb_1",
          action: "Enrollment EFB - Step 1 View",
          isMatch: () => /\/baby-formula-coupons-samples/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === ""
                         || /\/products\/subscribe-and-save/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === ""
                         || /\/enrollment-forms\/\?action=sign-up$/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === "",
          /*isMatch: () => /\/enrollment/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === ""
                         || /\/products\/subscribe-and-save/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === ""
                         || /\/enrollment-forms\/\?action=sign-up$/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === "",*/
          listeners: [
            Evergage.listener("submit", ".register-form", () => {
              const evgDOB = Evergage.cashDom("#childregisterChildBirthDateField").val();
              Evergage.sendEvent({
                action: "Enrollment EFB - Step 1 Complete", user: {
                  attributes: { 
                    enrolmentProgramName: "EFB",
                    childDueDate: Date.parse(evgDOB)
                  }
                }
              });
            }),
          ]
        },
        // Enrollment EFB 2
        {
          name: "enrollment_efb_2",
          action: "Enrollment EFB - Step 2 View",
          isMatch: () => /\/baby-formula-coupons-samples/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === "2/3",
          //isMatch: () => /\/enrollment/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === "2/3",
          listeners: [
            Evergage.listener("submit", ".register-form", () => {
              Evergage.sendEvent({
                action: "Enrollment EFB - Step 2 Complete", user: {
                }
              });
            }),
          ]
        },
        // Enrollment EFB 3
        {
          name: "enrollment_efb_3",
          action: "Enrollment EFB - Step 3 View",
          isMatch: () => /\/baby-formula-coupons-samples/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === "3/3",
          //isMatch: () => /\/enrollment/i.test(window.location.href) && Evergage.cashDom(".personal-details__order").text() === "3/3",
          listeners: [
            Evergage.listener("submit", ".register-form", () => {
              Evergage.sendEvent({
                action: "Enrollment EFB - Step 3 Complete", user: {
                  attributes: {
                    declaredFeedingIssue: Evergage.resolvers.fromSelectorAttributeMultiple('.form-control__checkbox-option.active > input', 'value', (issues) => {
                      let res = issues.map((issue) => {
                        if (issue === "GasAndFussiness") issue = "Gas,Fussiness,Gas And Fussiness";
                        if (issue === "CryingOrColic") issue = "Crying,Colic,Crying Or Colic";
                        if (issue === "LactoseIntolerance") issue = "Lactose Intolerance";
                        if (issue === "OccasionConstipation") issue = "Occasion Constipation";
                        if (issue === "LactoseSensitivity") issue = "Lactose Sensitivity";
                        if (issue === "CowsMilkAllergies") issue = "Cow's Milk Allergy"; 
                        return issue;
                      });
                      return res.join(",");
                    })()
                  }
                } 
              });
            }),
          ]
        },
        // Shop Landing     
        {
          name: "shop_landing",
          action: "Shop Landing",
          isMatch: () => /^https?:\/\/[^\/]*(\/)?(en\/|es\/)?(products|productos)(\/?\?{0}|\/?\?{1}.*)$/i.test(window.location.href),
          contentZones: [
            // {name: "shop_featured_products", selector: ".personalization-featured-products-shop > div > .slideshow-picker.slideshow-picker--tab > div.row > div.col > div.slideshow-picker__slide:nth-of-type(1) > section > div > div  > div > div > .product-list__products"},
            {name: "shop_featured_products", selector: ".personalization-featured-products-shop .product-list__products"},
            {name: "shop_testimonials", selector: ".personalization-testimonials-shop > div > .carousel > .slider > .slider-frame > ul"},
            {name: "shop_hero_banner", selector: ".personalization-hero-banner-shop"},
          ],
        },
        // 11-11   
        {
          name: "campaign_11_11_landing",
          action: "Campaign 11-11 Landing",
          isMatch: () => /^https?:\/\/[^\/]*(\/)?(en\/|es\/)?(11-11)(\/?\?{0}|\/?\?{1}.*)$/i.test(window.location.href),
          contentZones: [
            {name: "landing_11_11_hero_banner", selector: ".page-banner--withdisclaimer"},            
          ],
        },   
        // PDP
        {
          name: "product_detail",
          action: "Product Detail",
          // The data Layer is not ready immediatly after landing in the page from an email, so we wait a little for it to exist and to be populated
          // LazyLoad Fix: We also wait for the image URL to be present in the page. This happens when the client scrolls down a little.
          isMatch: () => {
            if (!/^https?:\/\/[^\/]*enfamil.com(\/)?(en\/|es\/)?(products|productos)\/[^\/]{1}(\/?\?{0}|\/?\?{1}.*)/i.test(window.location.href)) {
              return false;
            } else {
              return Promise.all([
                isMatchDataLayerEeAction("eeProductDetail"),
                isMatchMutationObserver(".product-hero .slider-slide:first-child .product-hero__images-image-product", false),
                isMatchMutationObserver("button#ratings-summary > div.bv_avgRating_component_container", false)
              ]).then(result=>true).catch(error=>false);
            }      
          },
          contentZones: [
            {name: "pdp_related_products", selector: ".personalization-featured-products-pdp > div"},
          ],
          onActionEvent: (actionEvent) => setUserAttributesFromDataLayerEeAction(actionEvent, "eeProductDetail"),
          listeners: [
            Evergage.listener("click", "button.product-options__button-add", (btn) => {
              let lineItem = Evergage.util.buildLineItemFromPageState("input.product-options__quantity-input");
              let priceItem = Evergage.cashDom(".price__value--original");
              if (priceItem && priceItem.length > 0) {
                lineItem.price = priceItem[0].innerHTML.replace("$", "");

                if (btn && btn.path) {
                  // There are two "add to cart" buttons. The quantity is always 1 for the first one, but it must be retrieved from the DOM for the second button.
                  if (btn.path.find(k => k.className == "content-grid__row product-main-desktop-title") !== undefined) {
                    lineItem.quantity = 1;      
                  } else {
                    lineItem.quantity = Evergage.cashDom("input.product-options__quantity-input")[1].value;
                  }
                  
                  Evergage.sendEvent({
                    itemAction: Evergage.ItemAction.AddToCart,
                    cart: {
                      singleLine: {
                          Product: lineItem
                      }
                    }
                  });
                }
              }
            }),
          ],
          catalog: {
            Product: {
              _id: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].id),
              description: Evergage.resolvers.fromSelector(".product-hero__images-title", (title) => title.replace("’", "'")),
              name: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].name),
              url: Evergage.resolvers.fromHref((url) => location.protocol + '//' + location.host + location.pathname.split("/").slice(0, 3).join("/") + "/"),
              imageUrl: Evergage.resolvers.fromSelectorAttribute(".product-hero .slider-slide:first-child .product-hero__images-image-product", "src"),
              listPrice: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].minPrice),
              price: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].minPrice),
              currency: "USD",
              inventoryCount: 1,
              // TODO: disabled because we can only see some of the variants on page load -> inventoryCount: Evergage.resolvers.fromSelectorMultiple("button.product-options__size-button:not(.product-options__size-button--no-stock)", (variants) => variants.length > 0 ? 1 : 0),
              numRatings: Evergage.resolvers.fromSelectorAttribute("button#ratings-summary > div.bv_numReviews_component_container > meta[itemprop=\"reviewCount\"]", "content", (value) => (typeof value === "undefined" ? null : parseFloat(value))),
              rating: Evergage.resolvers.fromSelector("button#ratings-summary > div.bv_avgRating_component_container", (value) => (typeof value === "undefined" || value === ""? null : parseFloat(value))),
              attributes: {
                color: Evergage.resolvers.fromSelector(".product-hero__slider-bg-hexgon--lg > path", () => { 
                  let color = Evergage.cashDom(".product-hero__slider-bg-hexgon--lg > path").css("fill");
                  if (color.indexOf('rgb') >= 0) {
                    color = rgbToHex(color);
                  }
                  return { value: color ? color.replace("#", "") : color };
                }),
                priceMin: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { return { value: dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].minPrice || 0 }}),
                priceMax: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { return { value: dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].maxPrice || 0 }}),
                promo: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { return { value: dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].promo}}),
              },
              categories: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => [dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].category]),
              dimensions: {   
                BabyStage: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { 
                  let items = dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].productTaxonomy;
                  if (items) {
                    items = items.filter(item => item.split("|")[0] === "Stage ");
                    items = items.map(item => item.split("|")[1].substring(1).replace("’", "'"));
                  }                  
                  return items;
                }),
                FeedingIssue: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { 
                  let items = dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].productTaxonomy;
                  if (items) {                
                    items = items.filter(item => item.split("|")[0] === "Feeding Issue ");
                    items = items.map(item => item.split("|")[1].substring(1).replace("’", "'"));
                  }
                  return items;
                }),
                ProductFamily: Evergage.resolvers.fromHref((url) => getProductFamily(url)),
                ProductType: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => [dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].type]),
                SpecialDietaryNeeds: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { 
                  let items = dataLayer.slice().reverse().find(k => k.eeAction=="eeProductDetail").products[0].productTaxonomy;
                  if (items) {
                    items = items.filter(item => item === "Special Dietary Needs");
                    items = items.length > 0 ? ["Yes"] : ["No"];
                  }
                  return items;
                }),
              },
            }
          },
        },
        // Cart
        {
          name: "cart",
          action: "View Cart",
          itemAction: Evergage.ItemAction.ViewCart,
          isMatch: () => {
            if (!/\/cart/.test(window.location.href)) {
              return false;
            } else {
              return isMatchCartData();
            }
          },
          onActionEvent: (actionEvent) => {
            // Set the shopify ID, if present
            if (meta && meta.page && meta.page.customerId) {
              if (!actionEvent.user) actionEvent.user = {};
              if (!actionEvent.user.attributes) actionEvent.user.attributes = {};
              actionEvent.user.attributes.shopifyUserID = `${meta.page.customerId}`;
            }
            return actionEvent;
          },
          catalog: {
            Product: {
              lineItems: {
                _id: Evergage.resolvers.fromWindow("customCart", cart => cart.items ? cart.items.map(item => item.product_id) : null),
                price: Evergage.resolvers.fromWindow("customCart", cart => cart.items ? cart.items.map(item => (item.price/100).toFixed(2)) : null),
                quantity: Evergage.resolvers.fromWindow("customCart", cart => cart.items ? cart.items.map(item => item.quantity) : null),
              }
            }
          }
        },
        // Order Confirmation
        {
          name: "order_confirmation",          
          action: "Purchase",
          itemAction: Evergage.ItemAction.Purchase,
          isMatch: () => {
            if (!/\/thank_you/.test(window.location.href)){
              return false;
            } else {
              return isMatchOrderData();
            }
          },
          catalog: {
            Product: {
              orderId: Evergage.resolvers.fromWindow("$order_data", order => order.order_id),
              totalValue: Evergage.resolvers.fromWindow("$order_data", order => parseFloat(order.subtotal_price)),
              currency: Evergage.resolvers.fromWindow("$order_data", order => order.currency),
              lineItems: {
                _id: Evergage.resolvers.fromWindow("$order_data", cart => cart.line_items.map(item => item.product_id)),
                price: Evergage.resolvers.fromWindow("$order_data", cart => cart.line_items.map(item => parseFloat(item.price))),
                quantity: Evergage.resolvers.fromWindow("$order_data", cart => cart.line_items.map(item => item.quantity)),
              }
            }
          }
        },
        // Cart With Subscription
        {
          name: "cart_subscription",
          action: "View Cart With Subscription",
          itemAction: Evergage.ItemAction.ViewCart,
          isMatch: () => /r\/checkout/.test(window.location.href),
          onActionEvent: (actionEvent) => {
            // Set the shopify ID, if present
            const shopifyId = Evergage.util.getParameterByName('customer_id');
            if (shopifyId) {
              if (!actionEvent.user) actionEvent.user = {};
              if (!actionEvent.user.attributes) actionEvent.user.attributes = {};
              actionEvent.user.attributes.shopifyUserID = shopifyId;
            }
            return actionEvent;
          },
          catalog: {
            Product: {
              lineItems: {    
                _id: Evergage.resolvers.fromWindow("cart_json", cart => cart.line_items ? cart.line_items.map(item => item.product_id) : null),
                price: Evergage.resolvers.fromWindow("cart_json", cart => cart.line_items ? cart.line_items.map(item => item.decimal_price) : null),
                quantity: Evergage.resolvers.fromWindow("cart_json", cart => cart.line_items ? cart.line_items.map(item => item.quantity) : null),
              }
            }
          }
        },
        // Order Confirmation With Subscription
        {
          name: "order_confirmation_subscription",          
          action: "Purchase With Subscription",
          itemAction: Evergage.ItemAction.Purchase,
          isMatch: () => /\/r\/purchase\/thanks/.test(window.location.href),
          onActionEvent: (actionEvent) => {
            if (!actionEvent.user) actionEvent.user = {};
            if (!actionEvent.user.attributes) actionEvent.user.attributes = {};
            actionEvent.user.attributes.hasPurchasedAutoRenew = true;
            return actionEvent;
          },
          catalog: {
            Product: {
              orderId: Evergage.resolvers.fromWindow("cart_json", cart => cart.external_checkout_id),
              totalValue: Evergage.resolvers.fromWindow("cart_json", cart => parseFloat(cart.subtotal_price)),
              currency: Evergage.resolvers.fromWindow("cart_json", cart => cart.currency),
              lineItems: {
                _id: Evergage.resolvers.fromWindow("cart_json", cart => cart.line_items ? cart.line_items.map(item => item.product_id) : null),
                price: Evergage.resolvers.fromWindow("cart_json", cart => cart.line_items ? cart.line_items.map(item => parseFloat(item.decimal_price)) : null),
                quantity: Evergage.resolvers.fromWindow("cart_json", cart => cart.line_items ? cart.line_items.map(item => item.quantity) : null),
              }
            }
          }
        },
        // Article
        {
          name: "article",
          action: "Article",
          isMatch: () => {
            if (!/^https?:\/\/[^\/]*enfamil\.com(\/)?(en\/|es\/)?(articles|articulos)\/[^\/]{1}(\/?\?{0}|\/?\?{1}.*)/i.test(window.location.href)) {
              return false;
            } else {
              return isMatchDataLayer("article");
            }
          },
          contentZones: [
            {name: "related_articles_carousel", selector: ".related-articles-wrapper"}
          ],
          catalog: {
            /* We are not using the resolver fromJsonLd because the page contains more than one ld+json script, and the resolver defaults to the first one */
            Article: {
              _id: Evergage.resolvers.fromSelectorAttribute(".RBStarterKitContentGridPage", "data-page-id"),
              name: Evergage.resolvers.fromSelector("article > script[type='application/ld+json']", (json) => {
                let value = "";
                try {
                  json = JSON.parse(json);
                  value = json.headline;
                } catch (e) {
                }
                return value;
              }),
              description: Evergage.resolvers.fromSelector("article > script[type='application/ld+json']", (json) => {
                let value = "";
                try {
                  json = JSON.parse(json);
                  value = json.description;
                } catch (e) {
                }
                return value;
              }),
              url: Evergage.resolvers.fromHref((url) => url.split("?")[0]),
              published: Evergage.resolvers.fromSelector("article > script[type='application/ld+json']", (json) => {
                let value = "";
                try {
                  json = JSON.parse(json);
                  value = json.datePublished;
                } catch (e) {
                }
                return value;
              }),
              imageUrl: Evergage.resolvers.fromSelector("article > script[type='application/ld+json']", (json) => {
                let value = "";
                try {
                  json = JSON.parse(json);
                  value = json.image;
                  if (value.includes("enfamil-favicon-new-1.png")) {
                    value = "https://d2jiwtuosjkcsj.cloudfront.net/media/1054/default-article-image-pc.jpg"
                  } else if (value.indexOf("?") > 0) {
                    value = value.substr(0, value.indexOf("?"))
                  }
                } catch (e) {
                }
                return value;
              }),
              dimensions: {
                Locale: Evergage.resolvers.fromMeta("og:locale", (content) => content !== undefined ? [content.substring(0, 3) + content.substring(3).toUpperCase()] : ["en_US"]),
                BabyStage: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => { 
                  let items = dataLayer.slice().find(k => k.articleTaxonomy).articleTaxonomy;
                  if (typeof items != 'undefined' && items != null && items != "") {
                    let terms = [];
                    terms = items.filter(item => item.categoryName === "Child")
                    if (typeof terms != 'undefined' && terms != null && terms != "") {
                        terms = terms[0].terms;
                    }
                    if (typeof terms == 'undefined') {
                      let subCategories = [];
                      subCategories = items.filter(item => item.categoryName === "Child")
                      items = [];
                      let i = 0;
                      for (i = 0; i < subCategories[0].subcategories.length; i++) {
                        items.push(subCategories[0].subcategories[i].subcategoryName)
                      }
                    } else {
                      items = terms;
                    }
                  }
                  return items;
                }),
                FeedingIssue: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => {
                  let items = dataLayer.slice().find(k => k.articleTaxonomy).articleTaxonomy;
                  if (typeof items != 'undefined' && items != null && items != "") {
                    items = items.filter(item => item.categoryName === "Baby Feeding");
                    if (typeof items != 'undefined' && items != null && items != "") {
                      items = items[0].terms
                    } else {
                      items = [];
                    }
                  } else {
                      items = [];
                  }
                  return items;
                }),
                FormulaScore: Evergage.resolvers.fromWindow("dataLayer", (dataLayer) => {
                  let items = dataLayer.slice().find(k => k.articleTaxonomy).articleTaxonomy;
                  if (typeof items != 'undefined' && items != null && items != "") {
                    items = items.filter(item => item.categoryName === "Formula Relevance Inventory");
                    if (typeof items != 'undefined' && items != null && items != "") {
                      items = items[0].terms
                    } else {
                      items = [];
                    }
                  } else {
                      items = [];
                  }
                  return items;
                }),
              }
            }
          },
        },
      ]
  };

 /*
  * Set a cookie
  */
  const setCookie = (name, value, daysToLive) => {
    var cookie = name + "=" + encodeURIComponent(value);    
    if(typeof daysToLive === "number") {
        cookie += "; max-age=" + (daysToLive*24*60*60) + "; path=/";       
        document.cookie = cookie;
    }
  };

 /*
  * Get a cookie
  */
  const getCookie = (name) => {
    var cookieArr = document.cookie.split(";");
    for(var i = 0; i < cookieArr.length; i++) {
        var cookiePair = cookieArr[i].split("=");
        if(name == cookiePair[0].trim()) {
            return decodeURIComponent(cookiePair[1]);
        }
    }
    return null;
  };

 /*
  * Number of months between two dates
  */
  const getDiffMonths = (date) => {
    const currentDate = new Date();
    var diff =(currentDate.getTime() - date) / 1000;
    diff /= (60 * 60 * 24 * 7 * 4);
    return Math.abs(Math.round(diff));
  };

 /*
  * Number of weeks between two dates
  */
  const getDiffWeeks = (date) => {
    const currentDate = new Date();
    var diff =(currentDate.getTime() - date) / 1000;
    diff /= (60 * 60 * 24 * 7);
    return Math.abs(Math.round(diff));
  };

 /*
  * Baby Stage from date
  */
  const getBabyStage = (date) => {
    const months = getDiffMonths(date);
    let stage = "";
    if (months < 0) {
      stage = "Prenatal";
    } else if (months > 0 && months <= 12) {
      stage = "Infant";
    } else if (months > 12 && months <= 36) {
      stage = "Toddler";
    }
    return stage;
  };

 /*
  * Promise that is resolved true if the datalayer contains an element of a specific type.
  * The promise will retry a number of times and resolve to false if the element does not show up.
  */
  const isMatchDataLayer = (pageTemplate) => {
    let intervalCount = 0; 
    return new Promise((resolve, reject) => {
      const interval = setInterval(() => {
        intervalCount += 1;
        if (typeof dataLayer !== "undefined" &&
            typeof dataLayer.slice().reverse().find(k => k.pageTemplate==pageTemplate) !== "undefined") {
          clearInterval(interval);
          resolve(true);
        } else if (intervalCount > 50) {
          // console.log(`[EVG] Page type match helper isMatchDataLayer for "${pageTemplate}" timed out`, JSON.stringify(window.dataLayer));
          clearInterval(interval);
          resolve(false);
        }
      }, 100); 
    }).catch((error) => {
      console.log(`[EVG] Page type match helper isMatchDataLayer for "${pageTemplate}" FAILED`, JSON.stringify(error));
    });
  };

 /*
  * Promise that is resolved true if the datalayer contains an element of a specific type.
  * The promise will retry a number of times and resolve to false if the element does not show up.
  */
  const isMatchDataLayerEeAction = (eeAction) => {
    let intervalCount = 0; 
    return new Promise((resolve, reject) => {
      const interval = setInterval(() => {
        intervalCount += 1;
        if (typeof dataLayer !== "undefined" &&
            typeof dataLayer.slice().reverse().find(k => k.eeAction==eeAction) !== "undefined") {
          clearInterval(interval);
          resolve(true);
        } else if (intervalCount > 50) {
          // console.log(`[EVG] Page type match helper isMatchDataLayerEeAction for "${eeAction}" timed out`, JSON.stringify(window.dataLayer));
          clearInterval(interval);
          resolve(false);
        }
      }, 100); 
    }).catch((error) => {
      console.log(`[EVG] Page type match helper isMatchDataLayerEeAction for "${eeAction}" FAILED`, JSON.stringify(error));
    });
  };

 /*
  * Waits for an element satisfying selector to exist, then resolves promise with the element.
  * We can make the observed element mandatory (the promise is rejected if the element is not found before timeout)
  * Or we can make the observed element optional (the promise is resolved if the element is not found before timeout)
  */
  const isMatchMutationObserver = (selector, isRequired, timeout) => {
    return new Promise((resolve, reject) => {
      let timer;
      if (!timeout) timeout=3000;
      let el = document.querySelector(selector);
      if (el) {resolve(true);}
      let observer = new MutationObserver((mutationRecords, observer) => {
        // Query for elements matching the specified selector
        Array.from(document.querySelectorAll(selector)).forEach((element) => {
          resolve(true);
          //Once we have resolved we don't need the observer anymore.
          clearTimeout(timer);
          observer.disconnect();
        });
      })
      observer.observe(document.documentElement, {
          childList: true,
          subtree: true
      });
      timer = setTimeout(() => {
        observer.disconnect();
        if (isRequired){
          reject(false);
        } else {
          resolve(true);
        }
			}, timeout);
    });
  };

 /*
  * Promise that is resolved true if the datalayer contains an element of a specific type.
  * The promise will retry a number of times and resolve to false if the element does not show up.
  */
  const isMatchCartData = () => {
    let intervalCount = 0; 
    return new Promise((resolve, reject) => {
      const interval = setInterval(() => {
        intervalCount += 1;
        if (typeof customCart !== "undefined" && customCart.items) {
          clearInterval(interval);
          resolve(true);
        } else if (intervalCount > 10) {
          clearInterval(interval);
          resolve(false);
        }
      }, 500);
    });
  };

 /*
  * Promise that is resolved true if the datalayer contains an element of a specific type.
  * The promise will retry a number of times and resolve to false if the element does not show up.
  */
  const isMatchOrderData = () => {
    let intervalCount = 0; 
    return new Promise((resolve, reject) => {
      const interval = setInterval(() => {
        intervalCount += 1;
        if (typeof $order_data !== "undefined" && $order_data.line_items) {
          clearInterval(interval);
          resolve(true);
        } else if (intervalCount > 500) {
          clearInterval(interval);
          resolve(false);
        }
      }, 500);
    });
  };

 /*
  * Convert RGB colors to HEX
  */
  function rgbToHex(rgb) {
    let r, g, b;
    if (!rgb) return rgb;
    rgb = rgb.replace('rgb(', '').replace(')', '').replace(' ', '').replace(' ', '').replace(' ', '');
    r = parseInt(rgb.split(',')[0]);
    g = parseInt(rgb.split(',')[1]);
    b = parseInt(rgb.split(',')[2]);
    return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
  }

 /*
  *  SPA change control: Check for URL change every 2 seconds. If URL has changed, reinitialize beacon and sitemap.
  */
  const handleSPAPageChange = () => {
    let url = window.location.href;
    const urlChangeInterval = setInterval(() => {
        if (url !== window.location.href) {
            url = window.location.href;
            if (/r\/checkout/.test(window.location.href) 
             || /\/r\/purchase\/thanks/.test(window.location.href)) {
              console.log(`[EVG] ignoring SPA url change`);
            } else {
              Evergage.init(Evergage.getConfig()).then(() => {
                console.log('[EVG] Running sitemap (SPA)');
                Evergage.initSitemap(Evergage.getState().config);
              });
            }
        }
    }, 2000);
  };

 /*
  * Get Product Family from URL
  */
  const getProductFamily = (url) => {
    let family = [""];
    if (/neuropro-gentlease/.test(url)){
      family = ["Enfamil NeuroPro Gentlease"];
    } else if (/gentlease/.test(url)){
      family = ["Enspire Gentlease"];
    } else if (/enspire/.test(url)){
      family = ["Enfamil Enspire"];
    } else if (/nutramigen/.test(url)){
      family = ["Nutramigen"];
    } else if (/enfagrow/.test(url)){
      family = ["Enfagrow"];
    } else if (/enfacare/.test(url)){
      family = ["Enfacare"];
    } else if (/a2/.test(url)){
      family = ["A2"];
    } else if (/enfamom/.test(url)){
      family = ["Enfamom"];
    } else if (/reguline/.test(url)){
      family = ["Reguline"];
    } else if (/enfamil-a-r/.test(url) || /enfamil-ar/.test(url)){
      family = ["A.R."];
    } else if (/neuropro/.test(url)){
      family = ["NeuroPro Sensitive"];
    } else if (/probiotic/.test(url)){
      family = ["Probiotic Vitamins"];
    } else if (/vitamin/.test(url) || /-vi-/.test(url)){
      family = ["Vitamins"];
    } else if (/prosobee/.test(url)){
      family = ["Prosobee"];
    } else if (/enfaport/.test(url)){
      family = ["Enfaport"];
    } else if (/enfalyte/.test(url)){
      family = ["Enfalyte"];
    } else if (/puramino/.test(url)){
      family = ["Puramino"];
    }
    return family;
  };

 /*
  * Set user attributes from a datalayer item, filtering by a specific page template
  * This helper should only be used in page types matched by datalayer items
  */
  const setUserAttributesFromDataLayer = (actionEvent, pageTemplate) => {
    if (actionEvent.user ) {
      actionEvent.user.attributes = actionEvent.user.attributes ? actionEvent.user.attributes : {};
    } else {
      actionEvent.user = { attributes: {}};
    }
    const loginStatus = dataLayer.slice().reverse().find(k => k.pageTemplate==pageTemplate).loginStatus;
    const userId = dataLayer.slice().reverse().find(k => k.pageTemplate==pageTemplate).userId;
    if (loginStatus) {
      actionEvent.user.attributes.loginStatus = loginStatus;
    }
    if (userId) {
      actionEvent.user.id = userId;
      if (!actionEvent.user.attributes) actionEvent.user.attributes = {};
      actionEvent.user.attributes.individualID = userId;
    }
    return actionEvent
  };

 /*
  * Set user attributes from a datalayer item, filtering by a specific page template
  * This helper should only be used in page types matched by datalayer items
  */
  const setUserAttributesFromDataLayerEeAction = (actionEvent, eeAction) => {
    if (actionEvent.user ) {
      actionEvent.user.attributes = actionEvent.user.attributes ? actionEvent.user.attributes : {};
    } else {
      actionEvent.user = { attributes: {}};
    }
    const loginStatus = dataLayer.slice().reverse().find(k => k.eeAction==eeAction).loginStatus;
    const userId = dataLayer.slice().reverse().find(k => k.eeAction==eeAction).userId;
    if (loginStatus) {
      actionEvent.user.attributes.loginStatus = loginStatus;
    }
    if (userId) {
      actionEvent.user.id = userId;
      if (!actionEvent.user.attributes) actionEvent.user.attributes = {};
      actionEvent.user.attributes.individualID = userId;
    }
    return actionEvent
  };  

  handleSPAPageChange();

  Evergage.cashDom(function() {
    // console.log('[EVG] Running sitemap (main)');
    Evergage.initSitemap(config);
  });
});
} catch (e) {
    if (typeof window.Evergage === "object" && typeof window.Evergage.getVersion === "function" && window.Evergage.getVersion() >= 5) {
          console.error("siteWideJavascriptError" + e);    }
};

