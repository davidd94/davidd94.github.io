define(["jquery","mage/cookies",],function($){"use strict"
function iparcelLib(){if(!(this instanceof iparcelLib)){throw new TypeError("iparcelLib constructor cannot be called as a function.");}}
iparcelLib.prototype={sku:null,url:null,stock:null,maxQuantity:null,skuList:{},stockList:{},textSelectors:'.product-custom-option[type="text"], textarea.product-custom-option',addToCartFormSelector:'form#product_addtocart_form',productOptionsSelector:'.product-options-wrapper',itemNameSelector:'.item .product-item-name a',itemSelector:'.item',iparcelSkuClass:'iparcelsku',iparcelOptionsClass:'iparceloptions',iparcelStockClass:'iparcelstock',iparcelQuantityClass:'iparcelstockquantity',iparcelMaxQuantityClass:'iparcelmaxquantity',constructor:iparcelLib,initializeSingleProduct:function(){var skuElement=$("<div />");skuElement.css("display","none");skuElement.attr("class",this.iparcelSkuClass);$(this.addToCartFormSelector).append(skuElement);var optionsElement=$('<div />');optionsElement.css("display","none");optionsElement.attr("class",this.iparcelOptionsClass);$(this.addToCartFormSelector).append(optionsElement);var stockElement=$('<div />');stockElement.css("display","none");stockElement.attr("class",this.iparcelStockClass);$(this.addToCartFormSelector).append(stockElement);var quantityElement=$('<div />');quantityElement.css("display","none");quantityElement.attr("class",this.iparcelQuantityClass);$(this.addToCartFormSelector).append(quantityElement);var maxQuantityElement=$('<div />');maxQuantityElement.css("display","none");maxQuantityElement.attr("class",this.iparcelMaxQuantityClass);$(this.addToCartFormSelector).append(maxQuantityElement);},single:function(){this.url='/shippingip/ajax/configurable';this.setSku();this.setStock();this.setMaxQuantity();var iCookie=$.cookie('ipar_iparcelSession');if(!iCookie){;return;}
iCookie=JSON.parse(iCookie);if(!iCookie||!iCookie.locale||iCookie.locale=='US'){return;}
this.update();var self=this;$(this.productOptionsSelector).click(function(){self.update(self)});},applySkuList:function(){var self=this;$.each(self.skuList,function(sku,name){var skuElement=$('<div />');skuElement.css("display","none");skuElement.attr("class",self.iparcelSkuClass);skuElement.text(sku);self.append(skuElement,name);});},applyStockList:function(){var self=this;$.each(self.stockList,function(name,qty){var stockElement=$('<div />');stockElement.css("display","none");stockElement.attr("class",self.iparcelStockClass);stockElement.text(qty>0?'true':'false');self.append(stockElement,name);});},update:function(object){if(object==undefined){var formData=$(this.addToCartFormSelector).serialize();this.ajaxPost(formData);}else{var formData=$(object.addToCartFormSelector).serialize();object.ajaxPost(formData);}},setSku:function(){$('.'+this.iparcelSkuClass).text(this.sku);},setStock:function(){var stockBool=this.stock?'true':'false';$('.'+this.iparcelStockClass).text(stockBool);$('.'+this.iparcelQuantityClass).text(this.stock);},setMaxQuantity:function(){$('.'+this.iparcelMaxQuantityClass).text(this.maxQuantity);},setFinalSku:function(value){$('.'+this.iparcelSkuClass).attr('finalsku',value);},append:function(item,name){var itemElement=$(this.itemNameSelector).filter(function(){var itemName=$.trim($(this).text());name=$('<div />').html(name).text();return itemName==name;});itemElement.closest(this.itemSelector).append(item);},ajaxPost:function(data){var payload=data;var self=this;this.setFinalSku('false');$.ajax({url:this.url,data:payload,type:'GET',async:true,success:function(data){if(data){self.sku=data.sku;self.setSku();self.setFinalSku('true');self.stock=data.stock;self.setStock();self.maxQuantity=data.maxQuantity;self.setMaxQuantity();var optionsElement=$('.'+self.iparcelOptionsClass);optionsElement.empty();if(typeof data.attributes!=='undefined'&&data.attributes!==null){$.each(data.attributes,function(key,value){var block=$('<div />');block.attr('id',key);block.text(value);optionsElement.append(block);});}}
self.displayEligibility();}});},displayEligibility:function(){try{$_ipar.fn.iparcel.ux.displayEligibility();}catch(exception){}}};return iparcelLib;});